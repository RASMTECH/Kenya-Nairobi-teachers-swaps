<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <title>Teacher Swaps Kenya</title>
  <style>
    /* ... Your existing styles unchanged ... */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .blurred {
      filter: blur(5px);
      cursor: pointer;
      text-decoration: none;
      color: inherit;
    }
    .blurred:hover {
      filter: none; /* Hint at visibility after payment */
    }
    header {
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      text-align: center;
    }
    nav ul {
      list-style-type: none;
      padding: 0;
    }
    nav ul li {
      display: inline;
      margin: 0 10px;
    }
#swapTable th {
  color: red;
  font-weight: bold;
}

    main {
      padding: 20px;
    }
    footer {
      background-color: #4CAF50;
      color: white;
      text-align: center;
      padding: 10px;
      position: relative;
      bottom: 0;
      width: 100%;
    }
    form {
      max-width: 400px;
      margin: auto;
    }
    label {
      display: block;
      margin: 10px 0 5px;
    }
    input,
    select {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table,
    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
    }
    th {
      background-color: #4CAF50;
      color: white;
    }

    /* Payment Modal Styles */
    #paymentModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 10000;
    }
    #paymentModal .modal-content {
      margin: 15% auto;
      padding: 20px;
      background: white;
      width: 80%;
      max-width: 400px;
      text-align: center;
      border-radius: 8px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    }

    /* Alert Styling */
    .alert {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
      z-index: 1000;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
    }
  #matchesModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 70%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  .modal-content {
    background: white;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 500px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
    text-align: center;
  }
  .modal-content button {
  margin-top: 15px;
  padding: 10px 20px;
  background-color: #4CAF50; /* Green */
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.modal-content button:hover {
  background-color: #45a049; /* Slightly darker green for hover */
}

  #registerForm input {
    background-color: #e6f7ff; /* Light blue background */
    border: 2px solid #3399ff; /* Blue border */
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px;
    width: 100%;
    box-sizing: border-box;
    font-size: 16px;
  }

  #registerForm input:focus {
    background-color: #d0f0ff; /* Slightly brighter on focus */
    outline: none;
    border-color: #007acc;
  }

  #registerForm label {
    display: block;
    margin-top: 10px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  #registerForm button {
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #3399ff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }

  #registerForm button:hover {
    background-color: #007acc;
  }
  /* Common input/select styling */
  form input,
  form select {
    background-color: #e6f7ff;
    border: 2px solid #3399ff;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px;
    width: 100%;
    box-sizing: border-box;
    font-size: 16px;
  }

  form input:focus,
  form select:focus {
    background-color: #d0f0ff;
    outline: none;
    border-color: #007acc;
  }

  form label {
    display: block;
    margin-top: 10px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  form button {
    margin-top: 15px;
    padding: 10px 20px;
    background-color: #3399ff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
  }

  form button:hover {
    background-color: #007acc;
  }
  /* Styled input and select fields */
  form input,
  form select,
  select {
    background-color: #e6f7ff;
    border: 2px solid #3399ff;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 8px;
    width: 100%;
    box-sizing: border-box;
    font-size: 16px;
  }

  form input:focus,
  form select:focus,
  select:focus {
    background-color: #d0f0ff;
    outline: none;
    border-color: #007acc;
  }

  /* Labels */
  label {
    display: block;
    margin-top: 10px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  /* Buttons */
  button {
    margin: 8px 5px 15px 0;
    padding: 10px 16px;
    background-color: #3399ff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 15px;
    cursor: pointer;
  }

  button:hover {
    background-color: #007acc;
  }

  .trigger-button {
    background-color: #33cc99;
  }

  .trigger-button:hover {
    background-color: #29a37d;
  }
 #register {
    display: none;
    background-image: url('https://i.imgur.com/WKwJ73A.jpeg');
    background-size: cover;
    background-position: center;
    padding: 40px;
    border-radius: 12px;
    color: white;
    min-height: 100vh; /* full viewport height */
  }

  #register h2,
  #register label {
    color: white;
    text-shadow: 1px 1px 3px #000;
  }

  #registerForm {
    background-color: rgba(0, 0, 0, 0.5); /* semi-transparent form background */
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    margin: auto;
  }

  #registerForm input {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: none;
    border-radius: 5px;
  }

  #registerForm button {
    width: 100%;
    padding: 10px;
    background-color: #4CAF50;
    border: none;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }

  #registerForm button:hover {
    background-color: #45a049;
  }

 #login {
    display: none;
    background-image: url('  https://i.imgur.com/iqBwsWm.png           ');
    background-size: cover;
    background-position: center;
    padding: 40px;
    border-radius: 12px;
    color: white;
    min-height: 100vh;
  }

  #login h2,
  #login label {
    color: white;
    text-shadow: 1px 1px 3px #000;
  }

  #loginForm {
    background-color: rgba(0, 0, 0, 0.5); /* transparent dark background for form */
    padding: 20px;
    border-radius: 10px;
    max-width: 400px;
    margin: auto;
  }

  #loginForm input {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: none;
    border-radius: 5px;
  }

  #loginForm button {
    width: 100%;
    padding: 10px;
    background-color: #2196F3;
    border: none;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }

  #loginForm button:hover {
    background-color: #1976D2;
  }

#swaps {
  display: none;
  background-color: #4caf50; /* Green color */
  padding: 40px;
  border-radius: 12px;
  color: white;
  min-height: 100vh;
}


  #swaps h2,
  #swaps label {
    color: white;
    text-shadow: 1px 1px 3px #000;
  }

  #swapForm {
    background-color: rgba(0, 0, 0, 0.5); /* dark translucent form bg */
    padding: 20px;
    border-radius: 10px;
    max-width: 600px;
    margin: auto;
  }

  #swapForm input,
  #swapForm select {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: none;
    border-radius: 5px;
  }

  #swapForm button {
    width: 100%;
    padding: 10px;
    background-color: #ff9800;
    border: none;
    border-radius: 5px;
    color: white;
    font-weight: bold;
    cursor: pointer;
  }

  #swapForm button:hover {
    background-color: #f57c00;
  }
#swapTable th,
#swapTable td {
  color: black !important;        /* Make table text black */
  border: 2px solid black !important;  /* Make borders thick and black */
}

#swapTable {
  border: 2px solid black;        /* Outer border */
  border-collapse: collapse;
  background-color: white;        /* Optional: white background for clarity */
}

#swapTable th {
  background-color: #f2f2f2;      /* Optional: grey header for contrast */
}
.modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0; top: 0;
  width: 100%; height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.7);
}

.modal-content {
  background: linear-gradient(135deg, #fff0f6, #ffe6f0);
  margin: 10% auto;
  padding: 20px;
  border-radius: 12px;
  width: 80%;
  max-width: 350px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  font-family: 'Arial', sans-serif;
}

.modal-body p {
  margin: 10px 0;
  color: #444;
  font-size: 15px;
}

.close {
  float: right;
  font-size: 24px;
  font-weight: bold;
  color: #f44336;
  cursor: pointer;
}
.service-card {
  scroll-snap-align: start;
  padding: 20px;
  background: #f0f8ff; /* Light blue background */
  border: 1px solid #ccc;
  border-radius: 10px;
  min-height: 170px;
  width: 100%; /* âœ… Makes it fill available grid column */
  box-sizing: border-box; /* âœ… Includes padding in width */
  box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease; /* Optional: smooth hover effect */
}

.market-card {
  padding: 20px;
  background: #ffe4b5;
  border: 1px solid #ccc;
  border-radius: 10px;
  box-shadow: 1px 1px 6px rgba(0, 0, 0, 0.1);
  box-sizing: border-box;
  width: 100%; /* âœ… Allow it to fully fill the grid cell */
}

#bomJobsTable {
  width: 100%;
  border-collapse: collapse;
}

#bomJobsTable th,
#bomJobsTable td {
  border: 1px solid black;
  padding: 8px;
  text-align: left;
}

/* Bold black headers */
#bomJobsTable th {
  background-color: #f2f2f2;
  color: black;
  font-weight: bold;
}
#soulmateTable {
  width: 100%;
  border-collapse: collapse;
}

#soulmateTable th,
#soulmateTable td {
  border: 3px solid black;
  padding: 8px;
  text-align: left;
}

/* Bold and black headers */
#soulmateTable th {
  background-color: #f2f2f2;
  color: black;
  font-weight: bold;
}

/* Optional: alternate row background */
#soulmateTable tr:nth-child(even) {
  background-color: #fafafa;
}
  .form-wrapper {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 20px;
    padding: 20px;
  }

  .form-wrapper form {
    flex: 1;
    max-width: 600px;
    padding: 20px;
    border: 1px solid #ddd;
    border-radius: 10px;
    background: #f9f9f9;
  }

  .side-image {
    flex: 0 0 150px;
  }

  .side-image img {
    width: 100%;
    height: auto;
    border-radius: 10px;
  }

  form input,
  form select,
  form button {
    width: 100%;
    margin-bottom: 12px;
    padding: 10px;
    font-size: 16px;
  }

  form button {
    background-color: #007bff;
    color: white;
    border: none;
    cursor: pointer;
  }

  form button:hover {
    background-color: #0056b3;
  }

  @media (max-width: 768px) {
    .form-wrapper {
      flex-direction: column;
      align-items: center;
    }

    .side-image {
      display: none;
    }
  }
  .chat-bubble {
    display: flex;
    margin-bottom: 10px;
    max-width: 90%;
  }

  .chat-bubble.left {
    justify-content: flex-start;
  }

  .chat-bubble.right {
    justify-content: flex-end;
  }

  .chat-avatar {
    width: 35px;
    height: 35px;
    background: #bbb;
    color: white;
    border-radius: 50%;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    line-height: 35px;
    margin-right: 10px;
    flex-shrink: 0;
  }

  .chat-bubble.right .chat-avatar {
    order: 2;
    margin-left: 10px;
    margin-right: 0;
  }

  .chat-content {
    background: #f1f1f1;
    border-radius: 8px;
    padding: 8px 12px;
    max-width: 250px;
    position: relative;
  }

  .chat-bubble.right .chat-content {
    background: #007bff;
    color: white;
  }

  .chat-name {
    font-size: 0.9em;
    font-weight: bold;
    margin-bottom: 4px;
  }

  .chat-time {
    font-size: 0.75em;
    color: #999;
    text-align: right;
    margin-top: 4px;
  }
 .form-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px; /* space between items */
  }

  .side-image {
    width: 120px;
    height: auto;
  }

  #resourceForm {
    display: flex;
    flex-direction: column;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
  }

  #resourceForm label {
    margin-top: 10px;
  }

  #resourceForm input,
  #resourceForm button {
    margin-top: 5px;
    padding: 8px;
    font-size: 1rem;
  }

  #resourceForm button {
    margin-top: 15px;
    background-color: #1e90ff;
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #resourceForm button i {
    margin-right: 6px;
  }
.form-container {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
  }

  .side-image {
    width: 120px;
    height: auto;
  }

  #soulmateForm {
    display: flex;
    flex-direction: column;
    padding: 20px;
    background: #f9f9f9;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    max-width: 400px;
    flex: 1;
  }

  #soulmateForm label {
    margin-top: 10px;
    font-weight: bold;
  }

  #soulmateForm input,
  #soulmateForm select {
    margin-top: 5px;
    padding: 8px;
    font-size: 1rem;
  }

  #soulmateForm button {
    margin-top: 20px;
    background-color: #e91e63;
    color: white;
    border: none;
    padding: 10px;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border-radius: 4px;
  }

  #soulmateForm button i {
    margin-right: 6px;
  }
.swap-card button:hover {
  opacity: 0.9;
  cursor: pointer;
}
.job-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 16px;
  margin-bottom: 16px;
  background-color: #f9f9f9;
}

.job-card h3 {
  color: #2e7d32;
}

.job-card p {
  margin-bottom: 8px;
}

.job-card button {
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
}

.rating {
  margin-top: 10px;
}

.rating .fas {
  cursor: pointer;
  color: #ccc;
}
.soulmate-card {
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 16px;
  background-color: #f4f9f9;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
  width: 100%;           /* âœ… Fill available column space */
  box-sizing: border-box;
}
/* Photo Section */
.soulmate-photo img {
  border-radius: 8px;
  object-fit: cover;
  max-height: 200px;
  width: 100%;
}

/* Header Section (Name and Title) */
.soulmate-details h3 {
  color: #ffffff; /* White text for the name */
  font-size: 1.2em;
  background-color: #00796b; /* Green background for the name header */
  padding: 8px;
  border-radius: 8px;
  margin: 0;
  text-align: center;
}

/* Text Details Styling */
.soulmate-details p {
  margin-bottom: 5px;
  color: #333; /* Dark text color for clarity */
}

/* Contact Actions */
.contact-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.contact-actions a {
  color: #2196f3; /* Blue color for the phone/whatsapp links */
  text-decoration: none;
}

.contact-actions button {
  padding: 8px 12px;
  border-radius: 5px;
  cursor: pointer;
  background-color: #673ab7; /* Purple color for buttons */
  color: white;
  border: none;
  transition: background-color 0.3s ease;
}

.contact-actions button:hover {
  background-color: #5e35b1; /* Slightly darker purple on hover */
}

/* Rating Section */
.rating {
  margin-top: 10px;
}

.rating .fas {
  cursor: pointer;
  color: #ccc;
}

.rating .avg-rating {
  font-size: 1.1em;
  color: #00796b; /* Green color for the average rating */
}

/* Background Color Variations (Optional) */
.soulmate-card:nth-child(odd) {
  background-color: #e0f7fa; /* Light cyan for odd cards */
}

.soulmate-card:nth-child(even) {
  background-color: #f1f8e9; /* Light green for even cards */
}

.soulmate-details p {
  margin-bottom: 5px;
  color: #333; /* Dark text color */
  display: flex;
  align-items: center;
}

.soulmate-details p i {
  margin-right: 8px; /* Space between icon and text */
  color: #00796b; /* Color for the icons */
}

.soulmate-details h3 {
  font-size: 1.2em;
  display: flex;
  align-items: center;
}

.soulmate-details h3 i {
  margin-right: 8px;
}

.contact-actions button {
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  background-color: #673ab7;
  color: white;
  border: none;
}

.contact-actions a {
  color: #2196f3;
  text-decoration: none;
}
/* Highlight occupation with red background */
.highlight-occupation {
  color: red; /* Red text */
  font-weight: bold; /* Bold text */
  background-color: #ffebee; /* Light red background */
  padding: 4px; /* Padding to give space around the text */
  border-radius: 4px; /* Rounded corners */
}

.service-card {
  scroll-snap-align: start;
  padding: 20px;
  background: #f0f8ff; /* Light blue background */
  border: 1px solid #ccc;
  border-radius: 10px;
  min-height: 170px;
  width: 100%; /* âœ… Makes it fill available grid column */
  box-sizing: border-box; /* âœ… Includes padding in width */
  box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease; /* Optional: smooth hover effect */
}

/* Service Details */
.service-details {
  font-size: 1em;
}

.service-details p {
  margin-bottom: 5px;
  display: flex;
  align-items: center;
}

.service-details i {
  margin-right: 8px; /* Space between icon and text */
}

/* Contact Buttons */
.contact-actions a {
  color: #2196f3;
  text-decoration: none;
}

.contact-actions button {
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  background-color: #673ab7;
  color: white;
  border: none;
}

.contact-actions button:hover {
  background-color: #5e35b1;
}

/* Rating Stars */
.rating .fas {
  cursor: pointer;
  color: #ccc;
}
/* Highlight occupation with red background */
.highlight-occupation {
  color: red; /* Red text */
  font-weight: bold; /* Bold text */
  background-color: #ffebee; /* Light red background */
  padding: 4px; /* Padding to give space around the text */
  border-radius: 4px; /* Rounded corners */
}

/* Contact Buttons */
.contact-actions a {
  color: #2196f3;
  text-decoration: none;
}

.contact-actions button {
  padding: 6px 12px;
  border-radius: 5px;
  cursor: pointer;
  background-color: #673ab7;
  color: white;
  border: none;
}

.contact-actions button:hover {
  background-color: #5e35b1;
}

/* Rating Stars */
.rating .fas {
  cursor: pointer;
  color: #ccc;
}
.verified-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #e6f2ff;
  color: #007bff;
  font-weight: bold;
  font-size: 0.85em;
  padding: 4px 8px;
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}
.avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
}
 nav ul {
  list-style: none;
  padding: 0;
  margin: 0 auto;
  max-width: 1000px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 16px;
  justify-content: center;
}

nav ul li {
  text-align: center;
}

.menu-box {
  display: block;
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 10px;
  padding: 16px 10px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  text-decoration: none;
  color: #333;
}

.menu-box:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
}

.menu-box img {
  width: 80px;
  height: 80px;
  object-fit: contain;
  margin-bottom: 8px;
}

.menu-box span {
  display: block;
  font-size: 14px;
  font-weight: 600;
  margin-top: 4px;
}

/* Notification badge */
#notifBadge {
  display: none;
  background: red;
  color: white;
  border-radius: 50%;
  padding: 2px 6px;
  font-size: 11px;
  position: absolute;
  top: -5px;
  right: -5px;
}
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

.alert {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #4CAF50;
  color: white;
  padding: 15px;
  border-radius: 5px;
  text-align: center;
  z-index: 1000;
  box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.2);
}

</style>

</head>
<body>
<header>
<h1 style="color: red; font-weight: bold; display: flex; align-items: center; gap: 10px;">
  <i class="fas fa-star"></i>
  Nyota Mtaani â€“ Teacher Swaps & Daily Hustles
</h1>
<div style="border: 2px solid #1e90ff; border-radius: 10px; padding: 15px; background-color: #f9f9f9; max-width: 600px; margin: 20px auto;">
  <p style="font-style: italic; color: #555; font-size: 16px; text-align: center;">
    "From Village to City â€” Your Swap, Your Way: County Moves, Mtaani Vibes,All Jobs, Market,Soulmate,Services & Swaps â€” All in One Spot on Kenyaâ€™s #1 Nyota Platform for People Making Big Transitions."
  </p>
</div>


 <nav>
  <ul>
    <li><a class="menu-box" href="#" onclick="showPage('home')"><img src="https://i.imgur.com/lek58ah.jpeg" alt="Home"><span>Home</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('register')"><img src="https://i.imgur.com/jKZaOkH.jpeg" alt="Register"><span>Register</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('login')"><img src="https://i.imgur.com/TsXskJc.jpeg" alt="Login"><span>Login</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('swaps')"><img src="https://i.imgur.com/6bAPpPi.jpeg" alt="Swaps"><span>View Swaps</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('bomJobs')"><img src="https://i.imgur.com/8KM6Rib.jpeg" alt="Jobs"><span>My Jobs</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('resources')"><img src="https://i.imgur.com/GavIBlL.jpeg" alt="Resources"><span>Resources</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('soulmates')"><img src="https://i.imgur.com/mUbaq1y.jpeg" alt="Soulmate"><span>Soulmate</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('seekingServices')"><img src="https://i.imgur.com/P1tHi7L.jpeg" alt="Services"><span>Services</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('market')"><img src="https://i.imgur.com/P1MIsGM.jpeg" alt="Market"><span>Market</span></a></li>
    <li><a class="menu-box" href="#" onclick="showPage('contact')"><img src="https://i.imgur.com/SPqGvz9.jpeg" alt="Contact"><span>Contact Us</span></a></li>
    <li>
      <a class="menu-box" href="#" onclick="showPage('notifications')" style="position: relative;">
        <img src="https://i.imgur.com/CxqozEC.jpeg" alt="Notifications">
        <span>Notifications</span>
        <span id="notifBadge">0</span>
      </a>
    </li>
    <li><a class="menu-box" href="#" onclick="showMyChats()"><img src="https://i.imgur.com/6su2d7i.jpeg" alt="My Chats"><span>My Chats</span></a></li>
  </ul>
</nav>

</header>

  <main id="content">
<div id="home" class="page" style="display: none;">
<h2>
  <i class="fas fa-users" style="color:#3f51b5; margin-right: 8px;"></i>
  Connect with Other Employers
</h2>

  <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin: 20px 0;">
  <img src="https://i.imgur.com/jixmLF9.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/bbHniIi.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/qnmK7CR.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/WKwJ73A.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/4pi7IZ6.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/iqBwsWm.png" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/jgwKwKd.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/1anjN0C.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/J7NB5je.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/JYLKJ2p.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/HBsmybQ.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/XotAbEs.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/KmvHkzY.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/aYh8gq9.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/PrMgJG6.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/JXrL3JD.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/kkjlixE.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/fAtmMt4.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/7aWGYXS.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/5v3tav5.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/kEyIuZJ.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/1BJtGew.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/WYA3tbh.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/LFHI6v8.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/95vSNbW.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/WFVirtF.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/R7D2ECX.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/RuNhIix.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/uOQZLxF.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/buIgbl2.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
  <img src="https://i.imgur.com/vtJXjeb.jpeg" alt="Rasm" class="logo-img" style="width: 200px;">
</div>
<!-- Open Graph Meta Tags for social sharing -->
<meta property="og:title" content="Teacher Swaps Kenya" />
<meta property="og:description" content="Find your perfect teacher swap match across Kenya!" />
<meta property="og:image" content="https://i.imgur.com/WKwJ73A.jpeg" />
<meta property="og:url" content="https://rasmtech.github.io/Kenya-Nairobi-teachers-swaps/" />
<meta property="og:type" content="website" />

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="Teacher Swaps Kenya" />
<meta name="twitter:description" content="Find your perfect teacher swap match across Kenya!" />
<meta name="twitter:image" content="https://i.imgur.com/WKwJ73A.jpeg" />
   </div>
    <div id="register" class="page" style="display:none;">
   <h2>
  <i class="fas fa-user-shield" style="color:#f44336; margin-right: 8px;"></i>
  Register
</h2>

      <form id="registerForm">
        <label for="name">Name:</label>
        <input type="text" id="name" required />
        <label for="email">Email:</label>
        <input type="email" id="email" required />
        <label for="password">Password:</label>
        <input type="password" id="password" required />
 <button type="submit">
  <i class="fas fa-user-plus" style="margin-right: 6px; color: #ffffff;"></i> Register
</button>

      </form>
    </div>
    <div id="login" class="page" style="display:none;">
    <h2>
  <i class="fas fa-sign-in-alt" style="color:#2196f3; margin-right: 8px;"></i>
  Login
</h2>

      <form id="loginForm">
        <label for="loginEmail">Email:</label>
        <input type="email" id="loginEmail" required />
        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" required />
 <button type="submit">
  <i class="fas fa-sign-in-alt" style="margin-right: 6px; color: #ffffff;"></i> Login
</button>
<div id="vipControl" style="margin:10px 0;">
  <button onclick="showHotSwaps()" style="background:crimson; color:white; border:none; padding:8px 16px; border-radius:5px; cursor:pointer;">
    ðŸ”¥ VIP Swaps Available 
  </button>
</div>

      </form>
    </div>
    <div id="swaps" class="page" style="display:none;">
 <h2>
  <i class="fas fa-exchange-alt" style="color:#ff9800; margin-right: 8px;"></i>
  Register Your Swap Here
</h2>

      <form id="swapForm">
        <label for="teacherName">Teacher's Name:</label>
        <input type="text" id="teacherName" required />
        <label for="phone">Phone Number:</label>
        <input type="tel" id="phone" required />
        <label for="subjectCombination">Subject Combination:</label>
        <input type="text" id="subjectCombination" required />
        <label for="county">Current County:</label>
        <select id="county" required></select>
<label for="subCounty">Current Sub-county:</label>
<select id="subCounty" required>
  <option value="">Select Sub-county</option>
</select>
        <label for="swapCounty">Swap County To:</label>
        <select id="swapCounty" required></select>
        <label for="category">Category:</label>
        <select id="category" required>
          <option value="">Select Category</option>
          <option value="Primary School">Primary School Swaps</option>
          <option value="Junior Secondary">Junior Secondary Swaps</option>
          <option value="Senior Secondary">Senior Secondary Swaps</option>
        </select>
        <label for="hardship">Hardship:</label>
        <select id="hardship" required>
          <option value="Without Hardship">Without Hardship</option>
          <option value="With Hardship">With Hardship</option>
        </select>
 <button type="submit">
  <i class="fas fa-plus-circle" style="margin-right: 6px; color: #ffffff;"></i> Add Swap
</button>

 </form>
<h3><i class="fas fa-filter" style="color:#43a047; margin-right: 8px;"></i> Filter Swaps</h3>

<!-- âœ… Compact & Narrow Vertical Action Box -->
<div style="border: 2px solid #c8e6c9; background: #f1f8e9; padding: 12px; border-radius: 10px; margin-bottom: 16px; width: 220px; margin: 0 auto; display: flex; flex-direction: column; gap: 10px;">

  <!-- Category -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select id="filterCategory"
      style="width: 180px; background-color: #e0f7fa; border: 2px solid #26a69a; padding: 4px; border-radius: 6px; font-weight: bold;">
      <option value="">All</option>
      <option value="Primary School">Primary School</option>
      <option value="Junior Secondary">Junior Secondary</option>
      <option value="Senior Secondary">Senior Secondary</option>
    </select>
    <label for="filterCategory" style="margin-top: 2px; font-size: 12px; color: #00796b;">Category</label>
  </div>

  <!-- Swap County -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select id="filterSwapCounty" onchange="handleCountyChange('filterSwapCounty', 'filterSwapSubCounty')"
      style="width: 180px; background-color: #e1f5fe; border: 2px solid #039be5; padding: 4px; border-radius: 6px; font-weight: bold;">
    </select>
    <label for="filterSwapCounty" style="margin-top: 2px; font-size: 12px; color: #0277bd;">Swap County</label>
  </div>

  <!-- Swap Sub-county -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select id="filterSwapSubCounty"
      style="width: 180px; background-color: #f3e5f5; border: 2px solid #9c27b0; padding: 4px; border-radius: 6px; font-weight: bold;">
      <option value="">All Sub-counties</option>
    </select>
    <label for="filterSwapSubCounty" style="margin-top: 2px; font-size: 12px; color: #6a1b9a;">Swap Sub-county</label>
  </div>

  <!-- Hardship -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select id="filterHardship"
      style="width: 180px; background-color: #fff3e0; border: 2px solid #fb8c00; padding: 4px; border-radius: 6px; font-weight: bold;">
      <option value="">All</option>
      <option value="With Hardship">With Hardship</option>
      <option value="Without Hardship">Without Hardship</option>
    </select>
    <label for="filterHardship" style="margin-top: 2px; font-size: 12px; color: #ef6c00;">Hardship</label>
  </div>

  <!-- Subject Combination -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <input type="text" id="filterSubjectCombination" placeholder="e.g. Math/Physics"
      style="width: 180px; background-color: #f1f8e9; border: 2px solid #8bc34a; padding: 4px; border-radius: 6px; font-weight: bold;" />
    <label for="filterSubjectCombination" style="margin-top: 2px; font-size: 12px; color: #558b2f;">Subject</label>
  </div>
  <!-- Action Buttons -->
  <div style="display: flex; flex-direction: column; gap: 8px; align-items: center;">

    <button onclick="filterSwaps()" style="width: 180px; padding: 6px 10px; background: #43a047; color: white; border: none; border-radius: 6px; cursor: pointer;">
      <i class="fas fa-filter" style="margin-right: 6px;"></i> Filter Swaps
    </button>

    <button onclick="findMatchingSwaps()" style="width: 180px; padding: 6px 10px; background: #3f51b5; color: white; border: none; border-radius: 6px; cursor: pointer;">
      <i class="fas fa-handshake" style="margin-right: 6px;"></i> Find Matching Swaps
    </button>

    <button id="showTriangularSwap" class="trigger-button" style="width: 180px; padding: 6px 10px; background: #795548; color: white; border: none; border-radius: 6px; cursor: pointer;">
      <i class="fas fa-project-diagram" style="margin-right: 6px;"></i> Find Triangular Swap
    </button>

    <button onclick="showVipSwaps()" style="width: 180px; background: crimson; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer;">
      ðŸ”¥ View VIP Swaps
    </button>
<button id="showTriangularSwap" class="trigger-button" ...>

  </div>
</div>

<!-- âœ… End Vertical Action Box -->

<!-- âœ… Compact Action Box Wrapper End -->

<!-- âœ… Action Box Wrapper End -->

<h3>
  <i class="fas fa-people-arrows" style="color:#ff9800; margin-right: 8px;"></i>
  Registered Swaps
</h3>

<!-- ðŸ”¥ VIP Swaps Modal -->
<div id="vipSwapsModal" style="display:none; position:fixed; top:10%; left:10%; width:80%; max-height:80%; overflow:auto; background:white; padding:20px; border:2px solid crimson; border-radius:10px; z-index:9999; box-shadow:0 0 12px rgba(0,0,0,0.3);">
  <h3 style="color:crimson;">ðŸ”¥ Available VIP Swaps</h3>
  <div id="vipSwapsList"></div>
  <div style="text-align:right; margin-top:15px;">
    <button onclick="document.getElementById('vipSwapsModal').style.display='none'" style="padding:6px 12px; background:#ccc; border:none; border-radius:5px;">Close</button>
  </div>
</div>

<table id="swapTable">
  <thead>
    <tr>
      <th style="color: red; font-weight: bold;">Teacher's Name</th>
      <th style="color: red; font-weight: bold;">Current County</th>
      <th style="color: red; font-weight: bold;">Current Sub-county</th>
      <th style="color: red; font-weight: bold;">Phone Number</th>
      <th style="color: red; font-weight: bold;">Subject Combination</th>
      <th style="color: red; font-weight: bold;">Swap County To</th>
      <th style="color: red; font-weight: bold;">Swap Sub-county To</th>
      <th style="color: red; font-weight: bold;">Category</th>
      <th style="color: red; font-weight: bold;">Hardship</th>
      <th style="color: red; font-weight: bold;">VIP/Delete</th>
      <th style="color: red; font-weight: bold;">Rating</th>
    </tr>
  </thead>
  <tbody>
    <!-- Swap entries dynamically added here -->
  </tbody>
</table>

  </div>


<div id="bomJobs" class="page" style="display:none;">
<h2>
  <i class="fas fa-briefcase" style="color:#6f42c1; margin-right: 8px;"></i>
  Post Any Job Opportunity Here
</h2>
<!-- ðŸ” Flex container -->
<div class="form-wrapper">
  
  <!-- Left Image -->
  <div class="side-image">
 <img src="https://i.imgur.com/5bWHfIX.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/2YaRtCe.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/y4n1NSY.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/kKIs8rW.jpeg " alt="Left Side" class="side-image" />

  </div>

  <!-- The Form -->
  <form id="bomJobForm">
    <label for="bomOrg">Organization Name:</label>
    <input type="text" id="bomOrg" placeholder="e.g. Nyakemincha High School" required />

    <label for="bomJobType">Type of Job Opportunity:</label>
    <input type="text" id="bomJobType" placeholder="e.g. Teaching, Security, Cook" required />

    <label for="bomPhone">Contact (Phone Number):</label>
    <input type="tel" id="bomPhone" placeholder="e.g. 0712345678" required />

    <label for="bomSubCounty">Sub-county:</label>
    <select id="bomSubCounty" required>
      <option value="">Select Sub-county</option>
    </select>

    <label for="bomCounty">County:</label>
    <select id="bomCounty" required>
      <option value="">Select County</option>
    </select>

    <label for="bomSalaryRange">Expected Salary Range (Ksh):</label>
    <input type="text" id="bomSalaryRange" placeholder="e.g. 15000 - 25000" required />

    <label for="bomDate">Date Posted:</label>
    <input type="text" id="bomDate" readonly />

    <label for="bomPostedBy">Posted By (Name or Email):</label>
    <input type="text" id="bomPostedBy" placeholder="e.g. sironga@example.com" readonly />

    <button type="submit">
      <i class="fas fa-briefcase" style="margin-right: 6px; color: #ffffff;"></i>
      Post Job
    </button>
  </form>

  <!-- Right Image -->
  <div class="side-image">
   <img src="https://i.imgur.com/lIZ1IQi.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/XRks66A.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/KdsEBmH.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/rXTm8kr.jpeg " alt="Left Side" class="side-image" />

  </div>

</div>


<!-- ðŸ“¦ BOM Filter Action Box -->
<div style="border: 2px solid #c8e6c9; background: #f1f8e9; padding: 12px; border-radius: 10px; margin-bottom: 16px; display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-start;">

  <!-- County Filter -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select
      id="filterCounty"
      onchange="handleCountyChange('filterCounty', 'filterSubCounty')"
      style="width: 160px; background-color: #e3f2fd; border: 2px solid #42a5f5; padding: 6px; border-radius: 6px; font-weight: bold;"
    >
      <option value="">All Counties</option>
    </select>
    <label for="filterCounty" style="margin-top: 2px; font-size: 13px; color: #1565c0;">County</label>
  </div>

  <!-- Sub-county Filter -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <select
      id="filterSubCounty"
      style="width: 160px; background-color: #ede7f6; border: 2px solid #7e57c2; padding: 6px; border-radius: 6px; font-weight: bold;"
    >
      <option value="">All Sub-counties</option>
    </select>
    <label for="filterSubCounty" style="margin-top: 2px; font-size: 13px; color: #512da8;">Sub-county</label>
  </div>

  <!-- Salary Filter -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <input
      type="number"
      id="filterSalary"
      placeholder="Min Salary (Ksh)"
      style="width: 160px; background-color: #fffde7; border: 2px solid #fbc02d; padding: 6px; border-radius: 6px; font-weight: bold;"
    />
    <label for="filterSalary" style="margin-top: 2px; font-size: 13px; color: #f57f17;">Min Salary</label>
  </div>

  <!-- Apply Filters Button -->
  <div style="display: flex; flex-direction: column; align-items: center;">
    <button
      onclick="applyBOMFilters()"
      style="width: 160px; padding: 8px; background-color: #43a047; color: white; font-weight: bold;
             border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px;">
      <i class="fas fa-filter"></i> Apply Filters
    </button>
    <label style="visibility: hidden;">&nbsp;</label>
  </div>

</div>

<!-- Confirm Delete Modal -->
<div id="confirmDeleteModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:9999;">
  <div style="background:white; padding:20px; border-radius:8px; text-align:center;">
    <p>Are you sure you want to delete this BOM job?</p>
    <button id="confirmDeleteBtn" style="margin: 5px;">Yes, Delete</button>
    <button onclick="closeDeleteModal()" style="margin: 5px;">Cancel</button>
  </div>
</div>
<h3>
  <i class="fas fa-clipboard-list" style="color:#6f42c1; margin-right: 8px;"></i>
  Available Job Opportunities
</h3>

<div id="jobContainer" style="
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  width: 100%;               /* Fill full width of screen */
  padding: 10px 20px;        /* Optional horizontal padding */
  margin-top: 20px;
  overflow-y: auto;
  max-height: 600px;         /* Increase height to show more rows */
  scroll-snap-type: y mandatory;
  box-sizing: border-box;
">
  <!-- Example job cards -->
  <div style="background: #f1f1f1; padding: 15px; border-radius: 8px;">Job 1</div>
  <div style="background: #f1f1f1; padding: 15px; border-radius: 8px;">Job 2</div>
  <div style="background: #f1f1f1; padding: 15px; border-radius: 8px;">Job 3</div>
  <div style="background: #f1f1f1; padding: 15px; border-radius: 8px;">Job 4</div>
  <div style="background: #f1f1f1; padding: 15px; border-radius: 8px;">Job 5</div>
</div>


</div>
<div id="resources" class="page" style="display:none;">
<h2>
  <i class="fas fa-upload" style="color:#4CAF50; margin-right: 8px;"></i>
  Upload Teaching Resources
</h2>

 <div class="form-container">
  <img src="  https://i.imgur.com/x9v3Czl.jpeg" alt="Left Side" class="side-image" />

  <form id="resourceForm">
    <label for="resourceTitle">Title:</label>
    <input type="text" id="resourceTitle" required />

    <label for="resourcePrice">Price (Ksh):</label>
    <input type="number" id="resourcePrice" required />

    <label for="resourceFile">Upload File:</label>
    <input type="file" id="resourceFile" accept=".pdf,.doc,.docx,.ppt,.pptx" required />

    <button type="submit">
      <i class="fas fa-upload"></i> Upload Resource
    </button>
  </form>

  <img src="   https://i.imgur.com/ytrul2r.jpeg" alt="Right Side" class="side-image" />
</div>

 <h3>
  <i class="fas fa-book-open" style="color:#3f51b5; margin-right: 8px;"></i>
  Available Resources
</h3>

  <table id="resourcesTable">
    <thead>
      <tr>
        <th>Title</th>
        <th>Price (Ksh)</th>
        <th>Download</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
<div id="soulmates" class="page" style="display:none;">
<h3>
  <i class="fas fa-venus-mars" style="color:#e91e63; margin-right: 8px;"></i>
Register To Connect With  Available Soulmates
</h3>
<div class="form-container">
  <img src="   https://i.imgur.com/pfeMjzi.jpeg " alt="Left Side" class="side-image" />
<img src="   https://i.imgur.com/WKwJ73A.jpeg" alt="Left Side" class="side-image" />
<img src="   https://i.imgur.com/kngaoSj.jpeg" alt="Left Side" class="side-image" />
<img src="   https://i.imgur.com/dlbQbGo.jpeg" alt="Left Side" class="side-image" />
  <form id="soulmateForm">
    <label for="smName">Your Name:</label>
    <input type="text" id="smName" required />

    <label for="smCounty">Home County:</label>
    <select id="smCounty" required></select>

    <label for="smSubCounty">Home Sub-county:</label>
    <select id="smSubCounty" required>
      <option value="">Select Sub-county</option>
    </select>

    <label for="smAge">Age:</label>
    <input type="number" id="smAge" required />

    <label for="smTribe">Tribe:</label>
    <input type="text" id="smTribe" required />

    <label for="smSex">Sex:</label>
    <select id="smSex" required>
      <option value="">Select Sex</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>

    <label for="smOccupation">Occupation:</label>
    <input type="text" id="smOccupation" required />

    <label for="smWorkCounty">Work County:</label>
    <select id="smWorkCounty" required></select>

    <label for="smPhone">Phone Number:</label>
    <input type="tel" id="smPhone" required />

    <label for="smStatus">Marital Status:</label>
    <select id="smStatus" required>
      <option value="">Select Status</option>
      <option value="Single">Single</option>
      <option value="Married">Married</option>
      <option value="Divorced">Divorced</option>
      <option value="Widowed">Widowed</option>
    </select>

    <label for="smKids">Do you have kids?</label>
    <select id="smKids" required>
      <option value="">Select</option>
      <option value="Yes">Yes</option>
      <option value="No">No</option>
    </select>

    <label for="smPhoto">Upload Photo:</label>
    <input type="file" id="smPhoto" accept="image/*" required />

    <button type="submit">
      <i class="fas fa-heart"></i> Submit Profile
    </button>
  </form>
   <img src="https://i.imgur.com/mUvDPiM.jpeg " alt="Right Side" class="side-image" />
  <img src="https://i.imgur.com/4pi7IZ6.jpeg " alt="Right Side" class="side-image" />
 <img src="https://i.imgur.com/R0QCWyv.jpeg " alt="Right Side" class="side-image" />
<img src="https://i.imgur.com/dYvavhy.jpeg " alt="Right Side" class="side-image" />


</div>

<!-- â”€â”€â”€ FILTER UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!-- â”€â”€â”€ ACTION BOX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div 
  class="action-box" 
  style="
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    background-color: #fafafa;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    margin-bottom: 20px;
  "
>
  <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
    <!-- Age Filter -->
    <label for="ageFilter" style="width: 150px; font-weight: bold; color: #4caf50;">
      Filter by Age:
    </label>
    <select
      id="ageFilter"
      style="width: 150px; background-color: #f0f8ff; border: 1px solid #ccc; padding: 5px; border-radius: 4px;"
    >
      <option value="">All</option>
      <option value="20-29">20â€“29</option>
      <option value="30-39">30â€“39</option>
      <option value="40-49">40â€“49</option>
      <option value="50+">50+</option>
    </select>

    <!-- Tribe Filter -->
    <label for="filterTribe" style="width: 100px; font-weight: bold; color: #4caf50;">
      Tribe:
    </label>
    <input
      type="text"
      id="filterTribe"
      placeholder="e.g. Kikuyu"
      style="width: 120px; background:#f0f8ff; border:1px solid #ccc; padding:5px; border-radius:4px;"
    />

    <!-- Gender Filter -->
    <label for="filterSex" style="width: 100px; font-weight: bold; color: #4caf50;">
      Gender:
    </label>
    <select
      id="filterSex"
      style="width: 120px; background-color: #f0f8ff; border: 1px solid #ccc; padding: 5px; border-radius: 4px;"
    >
      <option value="">All</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>

    <!-- Actions -->
    <button 
      onclick="loadSoulmates()" 
      style="padding:6px 12px; background:#4caf50; color:#fff; border:none; border-radius:4px; cursor:pointer;"
    >
      Apply Filters
    </button>
    <button 
      onclick="resetSoulmateFilters()" 
      style="padding:6px 12px; background:#f44336; color:#fff; border:none; border-radius:4px; cursor:pointer;"
    >
      Reset
    </button>
  </div>
</div>

<h3 style="margin-top: 0;">
  <i class="fas fa-venus-mars" style="color:#e91e63; margin-right: 8px;"></i>
  <i class="fas fa-heart" style="color:#00796b; margin-right: 8px;"></i>
  Available Soulmates
</h3>

<div id="soulmateContainer"></div>


<!-- Soulmates Cards Container -->
<div id="soulmateContainer" style="
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* â¬…ï¸ reduced min width */
  gap: 25px;
  width: 100%;
  padding: 20px;
  margin-top: 20px;
  box-sizing: border-box;
">
  <div class="soulmate-card">Card 1</div>
  <div class="soulmate-card">Card 2</div>
  <div class="soulmate-card">Card 3</div>
</div>




</div>
<div id="soulmateModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="closeSoulmateModal()">&times;</span>
    <h3>Soulmate Profile</h3>
    <div id="soulmateDetails">
      <!-- Details will be injected here -->
    </div>
  </div>
</div>
<div id="messages" class="page" style="
  display: none;
  padding: 16px;
  max-width: 400px;           /* âœ… Limit width */
  margin: 20px auto;          /* âœ… Center horizontally and add top spacing */
  background: #fff;           /* âœ… Light background */
  border-radius: 10px;        /* âœ… Rounded corners */
  box-shadow: 0 2px 10px rgba(0,0,0,0.08); /* âœ… Subtle shadow */
">

  <button onclick="showPage('market')" style="margin-bottom: 12px;">â† Back to Market</button>

 <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 15px;">ðŸ’¬ Messages</h2>

<!-- Notification Message: Avoid Paying in advance, even for delivery -->
<div style="background-color: #ffeb3b; color: #d32f2f; padding: 12px; border-radius: 5px; margin-bottom: 20px; font-weight: 500; text-align: center; font-size: 14px;">
 ðŸ”º  <strong>Avoid Paying in advance, even for delivery!</strong> ðŸš«
</div>

<div id="chatWith" style="font-weight: bold; margin-bottom: 12px; font-size: 18px;"></div>

<!-- Chat messages -->
<div id="chatMessages" style="max-height: 300px; overflow-y: auto; background: #f9f9f9; padding: 12px; border-radius: 8px; border: 1px solid #ccc; margin-bottom: 15px; font-size: 14px; line-height: 1.6;"></div>

<!-- Quick chat buttons -->
<div style="margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 12px;">
  <button onclick="sendQuickMessage('Make an offer')" class="quick-chat-btn" style="background-color: #4caf50; color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s;">
    ðŸ’° Make an offer
  </button>
  <button onclick="sendQuickMessage('Is this available?')" class="quick-chat-btn" style="background-color: #2196F3; color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s;">
     Is this available?
  </button>
  <button onclick="sendQuickMessage('Last price?')" class="quick-chat-btn" style="background-color: #f44336; color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s;">
    ðŸ’¸ Last price?
  </button>
  <button onclick="sendQuickMessage('Please send me your location')" class="quick-chat-btn" style="background-color: #9c27b0; color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s;">
    ðŸ“ Ask for location
  </button>
  <button onclick="sendQuickMessage('Please call me')" class="quick-chat-btn" style="background-color: #ff9800; color: white; padding: 8px 16px; border-radius: 20px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: background-color 0.3s;">
    ðŸ“ž Please call me
  </button>
</div>

<!-- Input and Send -->
<div style="display: flex; gap: 12px; align-items: center;">
  <input type="text" id="chatInput" placeholder="Type your message..." style="flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #ccc; font-size: 14px; line-height: 1.6; outline: none; transition: border-color 0.3s;">
  <button onclick="sendChatMessage()" style="padding: 10px 20px; border-radius: 20px; border: none; background-color: #4caf50; color: white; font-size: 14px; font-weight: 500; cursor: pointer; transition: background-color 0.3s;">Send</button>
</div>

  </div>

<div id="notifications" class="page" style="display:none;">
  <h2>ðŸ”” My Notifications</h2>
  <ul id="notificationList"></ul>
</div>
<!-- My Chats Page -->
<div id="chatListPage" style="display:none;">
  <h2>ðŸ“‚ My Chats</h2>
  <div id="chatListContainer"></div>
</div>

<!-- Seeking Services Section -->
<div id="seekingServices" class="page" style="display:none;">
 <h2>
  <i class="fas fa-concierge-bell" style="color:#009688; margin-right: 8px;"></i>
 <h2 style="color: crimson;">Post Your Service</h2>


 <div class="form-container">
  <img src="https://i.imgur.com/3Bdn0Dx.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/79Aw5LM.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/yw7eeD6.jpeg " alt="Left Side" class="side-image" />
<img src="https://i.imgur.com/D83bieA.jpeg " alt="Left Side" class="side-image" />


  <form id="serviceForm">
    <label for="svcName">Name:</label>
    <input type="text" id="svcName" required />

    <label for="svcCounty">County:</label>
    <select id="svcCounty" required></select>

    <label for="svcSubCounty">Sub-county:</label>
    <select id="svcSubCounty" required>
      <option value="">Select Sub-county</option>
    </select>

    <label for="svcOccupation">Occupation:</label>
    <input type="text" id="svcOccupation" required />

    <label for="svcExperience">Experience (in years):</label>
    <input type="number" id="svcExperience" required />

    <label for="svcPhone">Phone Number:</label>
    <input type="tel" id="svcPhone" required />

    <button type="submit">
      <i class="fas fa-concierge-bell"></i> Submit Service
    </button>
  </form>
 <img src="https://i.imgur.com/qUGmfzC.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/V2t9pgK.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/lPPcTF4.jpeg " alt="Left Side" class="side-image" />
 <img src="https://i.imgur.com/GHIpXpv.jpeg " alt="Left Side" class="side-image" />
</div>
<h3>
 
<!-- âœ… Services Filter Action Box -->
<div style="border: 2px solid #c8e6c9; background: #f1f8e9; padding: 12px 16px; border-radius: 10px; margin-bottom: 20px;">

  <h3 style="margin-bottom: 12px; color: #2e7d32;"><i class="fas fa-filter" style="margin-right: 6px;"></i> Filter Services</h3>

  <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-start;">

    <!-- County Dropdown -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <select id="filterServiceCounty"
        onchange="filterServices()"
        style="width: 180px; background-color: #e8f5e9; border: 2px solid #81c784; padding: 6px; border-radius: 6px; font-weight: bold;">
        <option value="">-- Select County --</option>
        <option value="All Kenya">All Kenya</option>
        <!-- Other counties will be dynamically inserted -->
      </select>
      <label for="filterServiceCounty" style="font-size: 13px; color: #388e3c; margin-top: 4px;">County</label>
    </div>

    <!-- Occupation Input -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <input type="text" id="filterOccupation" placeholder="Search Occupation..."
        onkeyup="filterServices()"
        style="width: 180px; background-color: #f0f8ff; border: 2px solid #64b5f6; padding: 6px; border-radius: 6px; font-weight: bold;" />
      <label for="filterOccupation" style="font-size: 13px; color: #1976d2; margin-top: 4px;">Occupation</label>
    </div>

  </div>
</div>


<h3>
  <i class="fas fa-users-cog" style="color:#00796b; margin-right: 8px;"></i>
 <h3 style="color: crimson;">Available Service Providers</h3>


<!-- Services Cards Container -->
<div id="servicesContainer" style="
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 30px; /* âœ… Increased gap between cards */
  width: 100%;
  padding: 20px; /* âœ… Adds spacing inside the container */
  margin-top: 20px;
  overflow-y: auto;
  max-height: 600px;
  scroll-snap-type: y mandatory;
  box-sizing: border-box;
">
  <!-- Service cards will be dynamically added here -->
  <!-- Example cards for testing -->
  <div style="
    background: #e6f7ff;
    padding: 20px;             /* âœ… Spacing inside each card */
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Optional for nicer separation */
  ">
    <h4 style="margin: 0 0 10px;">Service 1</h4>
    <p style="margin: 0;">Description goes here.</p>
  </div>

  <div style="
    background: #e6f7ff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  ">
    <h4 style="margin: 0 0 10px;">Service 2</h4>
    <p style="margin: 0;">Description goes here.</p>
  </div>

  <div style="
    background: #e6f7ff;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  ">
    <h4 style="margin: 0 0 10px;">Service 3</h4>
    <p style="margin: 0;">Description goes here.</p>
  </div>
  </div>
  </div>
<div id="market" class="page" style="display:none;">
<h2 style="color: crimson;">ðŸ›’ Market place - Post & Browse Items</h2>

<div class="form-container">
   <img src=" https://i.imgur.com/nxHMHAI.jpeg" class="side-image" />
 <img src="https://i.imgur.com/nYPCM6a.jpeg " class="side-image" />
 <img src="https://i.imgur.com/uyloDlg.jpeg " class="side-image" />
 <img src="https://i.imgur.com/CLnRHF4.jpeg" class="side-image" />
  <form id="marketForm">
    <div class="form-section-title">ðŸ“¦ Post Marketplace Item</div>

    <label for="itemName">Item Name</label>
    <input type="text" id="itemName" placeholder="Item Name" required>

    <label for="itemCategory">Category</label>
    <select id="itemCategory" required>
      <option value="">ðŸ”½ Select Category</option>
      <option value="Electronics">ðŸ’» Electronics</option>
      <option value="Phones">ðŸ“± Phones</option>
      <option value="Cars">ðŸš— Cars</option>
      <option value="HousesApartments">ðŸ  Houses & Apartments</option>
      <option value="Clothes">ðŸ‘— Clothes</option>
      <option value="Shoes">ðŸ‘Ÿ Shoes</option>
      <option value="Bags">ðŸ‘œ Bags</option>
      <option value="Jewelry">ðŸ’ Jewelry</option>
      <option value="Watches">âŒš Watches</option>
      <option value="Books">ðŸ“š Books</option>
      <option value="Furniture">ðŸª‘ Furniture</option>
      <option value="HomeAppliances">ðŸ”Œ Home Appliances</option>
      <option value="Toys">ðŸ‘¯ðŸ‘¯ Toys</option>
      <option value="Food">ðŸ” Food</option>
      <option value="Health">ðŸ’Š Health</option>
      <option value="Beauty">ðŸ’„ Beauty</option>
      <option value="Sports">ðŸ€ Sports</option>
      <option value="Gaming">ðŸŽ® Gaming</option>
      <option value="Cameras">ðŸ“· Cameras</option>
      <option value="PetSupplies">ðŸ¶ Pet Supplies</option>
      <option value="BabyProducts">ðŸ¼ Baby Products</option>
      <option value="Stationery">ðŸ–Šï¸ Stationery</option>
      <option value="MusicalInstruments">ðŸŽ¸ Musical Instruments</option>
      <option value="Bicycles">ðŸš´ Bicycles</option>
      <option value="Gardening">ðŸª´ Gardening</option>
      <option value="Art">ðŸŽ¨ Art</option>
      <option value="Software">ðŸ§  Software</option>
      <option value="Cleaning">ðŸ§¼ Cleaning Supplies</option>
      <option value="Travel">ðŸ§³ Travel</option>
      <option value="AgricultureFarming">ðŸŒ¾ Agriculture & Farming</option>
      <option value="RepairConstruction">ðŸ› ï¸ Repair & Construction</option>
      <option value="LeisureActivities">ðŸ–ï¸ Leisure & Activities</option>
      <option value="Other">ðŸŒŸ Other</option>
    </select>

    <label for="itemDescription">Item Description</label>
    <textarea id="itemDescription" placeholder="Describe the item..." required></textarea>

    <label for="itemPrice">Price (KES)</label>
    <input type="number" id="itemPrice" placeholder="e.g. 1500" required>

    <label for="itemCounty">County</label>
    <select id="itemCounty" required>
      <option value="">Select County</option>
    </select>

    <label for="itemSubcounty">Sub-county</label>
    <select id="itemSubcounty" required>
      <option value="">Select Sub-county</option>
    </select>

    <label for="itemPhone">Phone Number</label>
    <input type="text" id="itemPhone" placeholder="e.g. 0712345678" required>

<label for="itemCondition">Condition</label>
<select id="itemCondition" required>
  <option value="New">New</option>
  <option value="Used">Used</option>
</select>

    <label for="itemPhoto">Upload Item Photo</label>
    <input type="file" id="itemPhoto" accept="image/*">

    <button type="submit">
      <i class="fas fa-upload"></i> Post Item
    </button>
  </form>

 <img src="https://i.imgur.com/vwwqSJU.jpeg " class="side-image" />
 <img src="https://i.imgur.com/s4w8sJa.jpeg " class="side-image" />
 <img src="https://i.imgur.com/bpolGgB.jpeg " class="side-image" />
 <img src="https://i.imgur.com/b3gZc2W.jpeg " class="side-image" />
</div>
  <div>
<!-- âœ… Market Filter Action Box -->
<div style="border: 2px solid #cfd8dc; background: #f5f5f5; padding: 12px 16px; border-radius: 10px; margin-bottom: 20px;">

  <h3 style="margin-bottom: 12px; color: #455a64;">
    <i class="fas fa-filter" style="margin-right: 6px;"></i>
    Filter Marketplace Items
  </h3>

  <div style="display: flex; flex-wrap: wrap; gap: 14px; align-items: flex-start;">

    <!-- Category Filter -->
    <div style="display: flex; flex-direction: column;">
      <label for="filterItemCategory" style="font-size: 13px; color: #607d8b; margin-bottom: 4px;">
        <i class="fas fa-tags" style="margin-right: 6px;"></i>Filter by Category:
      </label>
      <select id="filterItemCategory" onchange="filterMarketItems()"
        style="width: 180px; background-color: #e3f2fd; border: 2px solid #90caf9; padding: 6px; border-radius: 6px; font-weight: bold;">
        <option value="">ðŸ”½ Select Category</option>
        <option value="Electronics">ðŸ’» Electronics</option>
        <option value="Phones">ðŸ“± Phones</option>
        <option value="Cars">ðŸš— Cars</option>
        <option value="HousesApartments">ðŸ  Houses & Apartments</option>
        <option value="Clothes">ðŸ‘— Clothes</option>
        <option value="Shoes">ðŸ‘Ÿ Shoes</option>
        <option value="Bags">ðŸ‘œ Bags</option>
        <option value="Jewelry">ðŸ’ Jewelry</option>
        <option value="Watches">âŒš Watches</option>
        <option value="Books">ðŸ“š Books</option>
        <option value="Furniture">ðŸª‘ Furniture</option>
        <option value="HomeAppliances">ðŸ”Œ Home Appliances</option>
        <option value="Toys">ðŸ‘¯ðŸ‘¯ Toys</option>
        <option value="Food">ðŸ” Food</option>
        <option value="Health">ðŸ’Š Health</option>
        <option value="Beauty">ðŸ’„ Beauty</option>
        <option value="Sports">ðŸ€ Sports</option>
        <option value="Gaming">ðŸŽ® Gaming</option>
        <option value="Cameras">ðŸ“· Cameras</option>
        <option value="PetSupplies">ðŸ¶ Pet Supplies</option>
        <option value="BabyProducts">ðŸ¼ Baby Products</option>
        <option value="Stationery">ðŸ–Šï¸ Stationery</option>
        <option value="MusicalInstruments">ðŸŽ¸ Musical Instruments</option>
        <option value="Bicycles">ðŸš´ Bicycles</option>
        <option value="Gardening">ðŸª´ Gardening</option>
        <option value="Art">ðŸŽ¨ Art</option>
        <option value="Software">ðŸ§  Software</option>
        <option value="Cleaning">ðŸ§¼ Cleaning Supplies</option>
        <option value="Travel">ðŸ§³ Travel</option>
        <option value="AgricultureFarming">ðŸŒ¾ Agriculture & Farming</option>
        <option value="RepairConstruction">ðŸ› ï¸ Repair & Construction</option>
        <option value="LeisureActivities">ðŸ–ï¸ Leisure & Activities</option>
        <option value="Other">ðŸŒŸ Other</option>
      </select>
    </div>

    <!-- County Filter -->
    <div style="display: flex; flex-direction: column;">
      <label for="filterItemCounty" style="font-size: 13px; color: #37474f; margin-bottom: 4px;">
        <i class="fas fa-map-marker-alt" style="margin-right: 6px;"></i>County:
      </label>
      <select id="filterItemCounty" onchange="filterMarketItems()"
        style="width: 180px; background-color: #ede7f6; border: 2px solid #9575cd; padding: 6px; border-radius: 6px; font-weight: bold;">
        <option value="">All Kenya</option>
        <!-- More county options will be populated dynamically -->
      </select>
    </div>

    <!-- Min Price Filter -->
    <div style="display: flex; flex-direction: column;">
      <label for="filterMinPrice" style="font-size: 13px; color: #388e3c; margin-bottom: 4px;">
        <i class="fas fa-dollar-sign" style="margin-right: 6px;"></i>Min Price:
      </label>
      <input type="number" id="filterMinPrice" placeholder="KES 0" onchange="filterMarketItems()"
        style="width: 120px; background-color: #e8f5e9; border: 2px solid #a5d6a7; padding: 6px; border-radius: 6px; font-weight: bold;" />
    </div>

    <!-- Max Price Filter -->
    <div style="display: flex; flex-direction: column;">
      <label for="filterMaxPrice" style="font-size: 13px; color: #d84315; margin-bottom: 4px;">
        <i class="fas fa-dollar-sign" style="margin-right: 6px;"></i>Max Price:
      </label>
      <input type="number" id="filterMaxPrice" placeholder="KES 10000" onchange="filterMarketItems()"
        style="width: 120px; background-color: #ffebee; border: 2px solid #ef9a9a; padding: 6px; border-radius: 6px; font-weight: bold;" />
    </div>

    <!-- Apply & Reset Buttons -->
    <div style="display: flex; gap: 8px; margin-top: 6px;">
      <button onclick="filterMarketItems()"
        style="padding: 6px 12px; background: #4caf50; color: #fff; border: none; border-radius: 6px; cursor: pointer;">
        Apply Filters
      </button>
      <button onclick="resetMarketFilters()"
        style="padding: 6px 12px; background: #f44336; color: #fff; border: none; border-radius: 6px; cursor: pointer;">
        Reset
      </button>
    </div>

  </div>
</div>




<!-- Market Items Container -->
<div id="marketContainer" style="
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;                      /* âœ… Bigger space between cards */
  width: 100%;
  padding: 40px 30px;            /* âœ… Padding inside container */
  margin-top: 20px;
  box-sizing: border-box;
  background-color: #f9fbff;     /* Optional soft background */
">
  <!-- Example Market Cards -->
  <div style="
    background: #ffffff;
    padding: 20px;               /* âœ… Space inside the card */
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  ">
    <h4 style="margin: 0 0 10px;">Market Item 1</h4>
    <p style="margin: 0;">Description of the item here.</p>
  </div>

  <div style="
    background: #ffffff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  ">
    <h4 style="margin: 0 0 10px;">Market Item 2</h4>
    <p style="margin: 0;">Description of the item here.</p>
  </div>

  <div style="
    background: #ffffff;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  ">
    <h4 style="margin: 0 0 10px;">Market Item 3</h4>
    <p style="margin: 0;">Description of the item here.</p>
  </div>
</div>
<div id="contact" class="page" style="display:none;">
  <div>
    <h2><i class="fas fa-envelope-open-text"></i> Contact Us</h2>
    <p><i class="fas fa-envelope"></i> Email: support@teacherswapskenya.com</p>
    <p><i class="fas fa-phone"></i> Phone: +254 700 000 000</p>
    <p><i class="fas fa-phone"></i> Phone: +254 792 755 676</p>
    <p><i class="fab fa-facebook"></i> Facebook: <a href="#">Link</a></p>
    <p><i class="fab fa-youtube"></i> YouTube: <a href="#">Link</a></p>
    <p><i class="fab fa-telegram"></i> Telegram: <a href="#">Link</a></p>
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <a href="https://wa.me/254792755676" target="_blank" style="text-decoration: none;">
      <button style="background-color: #25D366; color: white; padding: 12px 25px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">
        <i class="fab fa-whatsapp" style="margin-right: 8px;"></i> Chat with Us on WhatsApp
      </button>
    </a>
  </div>
</div>

<!-- Floating Contact Buttons -->
<a href="https://wa.me/254792755676?text=Hi%2C%20I%20need%20help%20with%20Teacher%20Swaps%20Kenya"
   target="_blank"
   style="position: fixed; bottom: 20px; right: 20px; background-color: #25D366; color: white;
          border-radius: 50px; padding: 14px 20px; text-decoration: none; font-size: 16px;
          display: flex; align-items: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 9999;">
  <i class="fab fa-whatsapp" style="font-size: 20px; margin-right: 8px;"></i> Chat with Us
</a>


<a href="tel:+254792755676"
   style="position: fixed; bottom: 140px; right: 20px; background-color: #e74c3c; color: white;
          border-radius: 50px; padding: 14px 20px; text-decoration: none; font-size: 16px;
          display: flex; align-items: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 9999;">
  <i class="fas fa-phone-alt" style="font-size: 20px; margin-right: 8px;"></i> Call Us
</a>

<!-- Modals -->
<div id="triangularSwapsModal" style="display: none; justify-content: center; align-items: center;
  position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
  <div style="background: #fff; padding: 20px; border-radius: 8px; max-width: 500px; width: 100%; text-align: center;">
    <h2>Triangular Swaps</h2>
    <div id="triangularSwapsList" style="margin-top: 20px;"></div>
    <button id="closeTriangularSwapsModal" style="margin-top: 20px; padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
      Close
    </button>
  </div>
</div>

<div id="paymentModal" style="display: none;">
  <div class="modal-content">
    <p>Please pay Ksh 100 to M-Pesa number 0792755676.</p>
    <p>Your Payment Reference: <strong id="paymentRef"></strong></p>
    <button onclick="confirmPayment()">I Have Paid</button>
    <button style="background-color: #e74c3c;" onclick="closePaymentModal()">Cancel</button>
  </div>
</div>

<div id="matchesModal" style="display: none;">
  <div class="modal-content">
    <h3>Matching Swaps</h3>
    <div id="matchesList"></div>
    <button onclick="closeMatchesModal()">Close</button>
  </div>
</div>

<!-- Toast Container -->
<div id="toastContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>

<!-- Confirm Delete Modal -->
<div id="confirmDeleteModal" style="display:none; position: fixed; top: 0; left: 0;
  width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000; justify-content: center; align-items: center;">
  <div style="background: white; padding: 20px 25px; border-radius: 10px; box-shadow: 0 6px 12px rgba(0,0,0,0.3);
      width: 90%; max-width: 400px; text-align: center;">
    <h3 style="margin-bottom: 10px; color: #dc3545;">Confirm Deletion</h3>
    <p style="font-size: 16px;">Are you sure you want to delete this swap?</p>
    <div style="height: 8px; background: #eee; border-radius: 5px; margin-top: 15px;">
      <div id="confirmProgressBar" style="width: 100%; height: 8px; background-color: #28a745; border-radius: 5px;"></div>
    </div>
    <span style="color: crimson; font-weight: bold;">ðŸ”¥ VIP</span>
    <div style="margin-top: 20px;">
      <button id="confirmYes" style="background-color: #dc3545; color: white; padding: 10px 20px; border: none;
        border-radius: 6px; margin-right: 10px; cursor: pointer;">Yes, Delete</button>
      <button id="confirmNo" style="background-color: #6c757d; color: white; padding: 10px 20px; border: none;
        border-radius: 6px; cursor: pointer;">Cancel</button>
    </div>
  </div>
</div>

<!-- Notification Badge -->
<span id="notifBadge" style="display:none; background:red; color:white; border-radius:50%; padding:2px 6px;">0</span>





 


<div id="toastContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999;"></div>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
  // âœ… Firebase Config
  const firebaseConfig = {
    apiKey: "AIzaSyD7qfXm0hmz4oyvKzICwFQ2xQR1_RkLNYg",
    authDomain: "rowan-494f7.firebaseapp.com",
    databaseURL: "https://rowan-494f7-default-rtdb.firebaseio.com",
    projectId: "rowan-494f7",
    storageBucket: "rowan-494f7.firebasestorage.app",
    messagingSenderId: "158143387761",
    appId: "1:158143387761:web:2606fa93a3c812bddd23d0",
    measurementId: "G-V9Q98Q09F2"
  };

  // âœ… Firebase Init
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  const bomRef = db.collection("bomJobs");
  const soulmateRef = db.collection("soulmates");
  const resourceRef = db.collection("teachingResources");
  const servicesRef = db.collection("seekingServices");
  const marketRef = db.collection("marketItems");

  // âœ… Global State
  let isLoggedIn = false;
  let hasPaid = false;
  let hasPaid100 = false;
  let hasPaidVip1000 = false;
  let currentUser = null;
  let isAdmin = false;
  let currentUserId = null;

  // âœ… Load user payment status
  async function loadUserPaymentStatus() {
    if (!currentUserId) return;

    try {
      const userDoc = await db.collection("users").doc(currentUserId).get();
      const data = userDoc.data();

      hasPaid100 = data?.hasPaid100 || false;
      hasPaidVip1000 = data?.hasPaidVip1000 || false;
    } catch (error) {
      console.error("Error loading payment status:", error.message);
    }
  }

  // âœ… Monitor Auth State 
  auth.onAuthStateChanged(async user => {
    if (user) {
      currentUser = user;
      isLoggedIn = true;
      currentUserId = user.uid;

      const adminEmails = [
        "mashabiki@teacherswapskenya.com",
        "sironga@teacherswapskenya.com",
        "sironga1@teacherswapskenya.com",
        "admin@teacherswapskenya.com"
      ];
      isAdmin = adminEmails.includes(user.email);

      await loadUserPaymentStatus(); // âœ… Load payment info immediately after login

      attachMarketFormSubmit();
      loadMarketItems(); // âœ… Load marketplace (without redirect)

      if (isAdmin) {
        loadAdminNotifications();
        updateAdminNotifBadge();
      }

    } else {
      isLoggedIn = false;
      currentUser = null;
      currentUserId = null;
      isAdmin = false;
      hasPaid = false;
      hasPaid100 = false;
      hasPaidVip1000 = false;
      showPage("home");
    }
  });

// âœ… Hot counties for VIP swap prioritization
const vipHotCounties = ["Nairobi", "Kisumu", "Mombasa", "Kisii", "Nakuru"];
// âœ… Counties and Sub-counties Map
const countySubCountyMap = {
"Mombasa": ["Changamwe", "Jomvu", "Kisauni", "Likoni", "Mvita", "Nyali"],
  "Kwale": ["Msambweni", "Lunga Lunga", "Matuga", "Kinango"],
  "Kilifi": ["Kilifi North", "Kilifi South", "Kaloleni", "Rabai", "Ganze", "Malindi", "Magarini"],
 "Tana River": ["Galole", "Garsen", "Bura", "Galedyertu", "Bangal"],
  "Lamu": ["Lamu East", "Lamu West"],
  "Taitaâ€“Taveta": ["Mwatate", "Voi", "Taveta", "Wundanyi"],
  "Garissa": ["Balambala", "Dadaab", "Fafi", "Garissa Township", "Hulugho", "Ijara", "Lagdera"],
  "Wajir": ["Eldas", "Tarbaj", "Wajir North", "Wajir East", "Wajir West", "Wajir South", "Buna"],
  "Mandera": ["Banisa", "Mandera West", "Mandera North", "Mandera South", "Mandera East", "Lafey"],
  "Marsabit": ["Moyale", "North Horr", "Saku", "Laisamis"],
  "Isiolo": ["Isiolo Central", "Merti", "Garbatulla"],
  "Meru": ["Imenti North", "Imenti South", "Imenti Central", "Tigania East", "Tigania West", "Buuri", "North Imenti"],
  "Tharaka-Nithi": ["Chuka/Igambang'ombe", "Maara", "Tharaka South", "Tharaka North"],
  "Embu": ["Manyatta", "Runyenjes", "Mbeere North", "Mbeere South"],
  "Kitui": ["Kitui Central", "Mwingi North", "Mwingi West", "Mwingi Central", "Kitui Rural", "Kitui South", "Kitui East", "Migwani"],
  "Machakos": ["Masinga", "Yatta", "Kangundo", "Matungulu", "Kathiani", "Mavoko", "Machakos Town", "Mwaki"],
  "Makueni": ["Mbooni", "Kaiti", "Kilome", "Mukaa", "Makueni", "Kibwezi East", "Kibwezi West"],
  "Nyandarua": ["Ol Joro Orok", "Kinangop", "Kipipiri", "Ndaragwa", "Ol Kalou"],
  "Nyeri": ["Tetu", "Nyeri Town", "Mathira", "Othaya", "Kieni", "Mukurweini"],
  "Kirinyaga": ["Kirinyaga Central", "Kirinyaga West", "Mwea", "Gichugu"],
  "Murang'a": ["Gatanga", "Kiharu", "Kigumo", "Kangema", "Mathioya", "Murang'a South"],
  "Kiambu": [ "Githunguri","Kiambu","Kabete","Kiambaa","Ruiru","Limuru", "Lari", "Juja","Thika Town","Gatundu North","Gatundu South","Kikuyu"],
  "Turkana": ["Turkana North", "Turkana West", "Turkana Central", "Loima", "Turkana South", "Turkana East"],
  "West Pokot": ["West Pokot", "North Pokot", "Central Pokot", "Pokot South", "Kipkomo", "Kacheliba"],
  "Samburu": ["Samburu East", "Samburu North", "Samburu West"],
  "Trans Nzoia": ["Kwanza", "Endebess", "Saboti", "Kiminini", "Cherangany"],
  "Uasin Gishu": ["Ainabkoi", "Kapseret", "Kesses", "Moiben", "Soy", "Turbo"],
  "Elgeyo-Marakwet": ["Keiyo North", "Keiyo South", "Marakwet East", "Marakwet West"],
  "Nandi": ["Aldai", "Chesumei", "Emgwen", "Mosop", "Nandi Hills", "Tinderet"],
  "Baringo": ["Baringo Central", "Baringo North", "Baringo South", "Eldama Ravine", "Mogotio", "Tiaty"],
  "Laikipia": ["Laikipia East", "Laikipia North", "Laikipia West"],
  "Nakuru": ["Bahati", "Gilgil", "Kuresoi North", "Kuresoi South", "Molo", "Naivasha", "Nakuru Town East", "Nakuru Town West", "Rongai", "Subukia"],
  "Narok": ["Narok East", "Narok North", "Narok South", "Narok West", "Trans Mara East", "Trans Mara West"],
  "Kajiado": ["Isinya", "Kajiado Central", "Kajiado East", "Kajiado North", "Kajiado South"],
  "Kericho": ["Ainamoi", "Belgut", "Bureti", "Kipkelion East", "Kipkelion West", "Soin/Sigowet"],
  "Bomet": ["Bomet Central", "Bomet East", "Chepalungu", "Konoin", "Sotik"],
  "Kakamega": ["Butere", "Ikolomani", "Khwisero", "Lugari", "Lurambi", "Malava", "Matungu", "Mumias East", "Mumias West", "Navakholo", "Shinyalu"],
  "Vihiga": ["Emuhaya", "Hamisi", "Luanda", "Sabatia", "Vihiga"],
  "Bungoma": ["Bumula", "Kabuchai", "Kanduyi", "Kimilili", "Mt. Elgon", "Sirisia", "Tongaren", "Webuye East", "Webuye West"],
  "Busia": ["Budalangi", "Butula", "Funyula", "Matayos", "Nambale", "Teso North", "Teso South"],
  "Siaya": ["Alego Usonga", "Bondo", "Gem", "Rarieda", "Ugenya", "Ugunja"],
  "Kisumu": ["Kisumu East", "Kisumu West", "Kisumu Central", "Muhoroni", "Nyakach", "Nyando", "Seme"],
  "Homa Bay": ["Homa Bay Town", "Kabondo Kasipul", "Kabondo East", "Mbita", "Ndhiwa", "Rachuonyo East", "Rachuonyo North", "Rachuonyo South", "Rangwe", "Suba North", "Suba South"],
  "Migori": ["Awendo", "Kuria East", "Kuria West", "Nyatike", "Rongo", "Suna East", "Suna West", "Uriri"],
  "Kisii": ["Bobasi", "Bomachoge Borabu", "Bomachoge Chache", "Bonchari", "Kitutu Chache North", "Kitutu Chache South", "Nyaribari Chache", "Nyaribari Masaba", "South Mugirango"],
  "Nyamira": ["Borabu", "Manga", "Masaba North", "Nyamira North", "Nyamira South"],
  "Nairobi City": ["Dagoretti North", "Dagoretti South", "Embakasi Central", "Embakasi East", "Embakasi North", "Embakasi South", "Embakasi West", "Kamukunji", "Kasarani", "Lang'ata", "Makadara", "Mathare", "Roysambu", "Ruaraka", "Starehe", "Westlands"]
};

// âœ… Populate Counties
function populateCounties(id, subCountyId = null) {
  const el = document.getElementById(id);
  el.innerHTML = `<option value="">Select County</option>`;
  
  // Populate county options
  Object.keys(countySubCountyMap).forEach(county => {
    const option = document.createElement("option");
    option.value = county;
    option.textContent = county;
    el.appendChild(option);
  });

  // If sub-county dropdown is provided, handle its population
  if (subCountyId) {
    const subCountyEl = document.getElementById(subCountyId);
    el.addEventListener("change", () => {
      const selectedCounty = el.value;
      subCountyEl.innerHTML = `<option value="">Select Sub-county</option>`;
      if (countySubCountyMap[selectedCounty]) {
        countySubCountyMap[selectedCounty].forEach(subCounty => {
          const option = document.createElement("option");
          option.value = subCounty;
          option.textContent = subCounty;
          subCountyEl.appendChild(option);
        });
      }
    });
  }
}

// âœ… Apply to county-subcounty pairs only (with event binding)
const countySubCountyPairs = [
  { county: "county", subCounty: "subCounty" },
  { county: "swapCounty", subCounty: "swapSubCounty" },
  { county: "filterSwapCounty", subCounty: "filterSwapSubCounty" },
  { county: "bomCounty", subCounty: "bomSubCounty" },
  { county: "svcCounty", subCounty: "svcSubCounty" },
  { county: "itemCounty", subCounty: "itemSubCounty" },
  { county: "filterItemCounty", subCounty: "filterItemSubCounty" },
  { county: "filterCounty", subCounty: "filterSubCounty" },
  { county: "filterServiceCounty", subCounty: "filterServiceSubCounty" },
  { county: "smCounty", subCounty: "smSubCounty" }
];
countySubCountyPairs.forEach(pair => populateCounties(pair.county, pair.subCounty));


// âœ… Initialize all county-subcounty dropdowns
countySubCountyPairs.forEach(pair => populateCounties(pair.county, pair.subCounty));



async function showPage(pageId) {
  if (pageId === "swaps" && !isLoggedIn) {
    showCustomAlert("You must be logged in to view swaps.", "error");
    showPage("login");
    return;
  }

  if (pageId === "resources" && !isLoggedIn) {
    showCustomAlert("Please login to view resources.", "error");
    showPage("login");
    return;
  }

  if (pageId === "messages" && !isLoggedIn) {
    showCustomAlert("Please login to access your messages.", "error");
    showPage("login");
    return;
  }

  if (pageId === "soulmates" && !isLoggedIn) {
    showCustomAlert("Please login to view or post soulmate profiles.", "error");
    showPage("login");
    return;
  }

  if (pageId === "seekingServices" && !isLoggedIn) {
    showCustomAlert("Please login to view or post services.", "error");
    showPage("login");
    return;
  }

  // Hide all pages
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");

  // Show requested page
  const page = document.getElementById(pageId);
  if (page) page.style.display = "block";

  // Page-specific logic
  if (pageId === "swaps" && isLoggedIn) loadSwaps();
  if (pageId === "bomJobs") loadBOMJobs();
  if (pageId === "resources") {
    await checkPaymentStatus();
    loadResources();
  }
  if (pageId === "soulmates") loadSoulmates();
  if (pageId === "seekingServices") loadServices();

  // âœ… If admin is viewing notifications, load them
  if (pageId === "notifications" && isAdmin) {
    loadAdminNotifications();
    updateAdminNotifBadge();
  }

if (pageId === "market") {
  populateCounties("itemCounty", "itemSubcounty"); // âœ… exact match for element ID
  loadMarketItems();
}

}



  // âœ… Register
  document.getElementById("registerForm").addEventListener("submit", async e => {
    e.preventDefault();
    const name = document.getElementById("name").value.trim();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    try {
      const userCred = await auth.createUserWithEmailAndPassword(email, password);
      currentUser = userCred.user;
      await currentUser.updateProfile({ displayName: name });
      showCustomAlert("Registration successful! Please login.", "success");
      showPage("login");
      e.target.reset();
    } catch (err) {
      showCustomAlert("Error: " + err.message, "error");
    }
  });

  // âœ… Login
  document.getElementById("loginForm").addEventListener("submit", async e => {
    e.preventDefault();
    const email = document.getElementById("loginEmail").value.trim();
    const password = document.getElementById("loginPassword").value;

    try {
      const userCred = await auth.signInWithEmailAndPassword(email, password);
      currentUser = userCred.user;
      isLoggedIn = true;

      const welcome = `Welcome ${currentUser.displayName || currentUser.email}!`;
      showCustomAlert(isAdmin ? `Admin Access: ${welcome}` : welcome, "success");

      showPage("swaps");
      e.target.reset();
    } catch (err) {
      showCustomAlert("Login failed: " + err.message, "error");
    }
  });

  // âœ… Logout
  function logout() {
    auth.signOut();
    isLoggedIn = false;
    currentUser = null;
    showPage("home");
    alert("Logged out.");
  }

  // âœ… Swap Form Submit
  document.getElementById("swapForm").addEventListener("submit", e => {
    e.preventDefault();
    if (!isLoggedIn || !currentUser) {
      showPage("login");
      return alert("You must be logged in.");
    }

 const data = {
  teacherName: document.getElementById("teacherName").value.trim(),
  phone: document.getElementById("phone").value.trim(),
  subjectCombination: document.getElementById("subjectCombination").value.trim(),
  county: document.getElementById("county").value,
  subCounty: document.getElementById("subCounty").value,
  swapCounty: document.getElementById("swapCounty").value,
  swapSubCounty: document.getElementById("swapSubCounty")?.value || "", // Optional
  category: document.getElementById("category").value,
  hardship: document.getElementById("hardship").value
};

// Validate only required fields
const requiredFields = ['teacherName', 'phone', 'subjectCombination', 'county', 'subCounty', 'swapCounty', 'category', 'hardship'];

const missing = requiredFields.some(key => !data[key]);
if (missing) {
  return alert("Please fill all fields.");
}


    saveSwap(data);
  });

  async function saveSwap(swap) {
    try {
      await db.collection("teacherSwaps").add({
        ...swap,
        userId: currentUser.uid,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      showCustomAlert("Swap added successfully!", "success");
      document.getElementById("swapForm").reset();
      loadSwaps();
    } catch (err) {
      showCustomAlert("Error saving swap: " + err.message, "error");
    }
  }
async function loadSwaps() {
  const tbody = document.querySelector("#swapTable tbody");
  tbody.innerHTML = "";

  try {
    const snapshot = await db.collection("teacherSwaps").orderBy("timestamp", "desc").get();

    if (snapshot.empty) {
      tbody.innerHTML = `<tr><td colspan="11">No swaps found.</td></tr>`;
      return;
    }

    const now = new Date();
    const boostedSwaps = [];
    const normalSwaps = [];

    for (const doc of snapshot.docs) {
      const s = doc.data();
      const id = doc.id;
      const boostExpiry = s.boostExpiry?.toDate?.();
      const isBoosted = s.boosted && boostExpiry && boostExpiry > now;

      if (s.boosted && (!boostExpiry || boostExpiry <= now)) {
        await db.collection("teacherSwaps").doc(id).update({ boosted: false, boostExpiry: null });
      }

      const swap = { id, ...s, isBoosted, boostExpiry };
      (isBoosted ? boostedSwaps : normalSwaps).push(swap);
    }

    const orderedSwaps = [...boostedSwaps, ...normalSwaps];

    for (const s of orderedSwaps) {
      const blur = !hasPaid && !isAdmin;
      const tr = document.createElement("tr");

      const isHotCounty = vipHotCounties.includes(s.county) || vipHotCounties.includes(s.swapCounty);
      const vipBtn = isAdmin && isHotCounty && !s.isVIP
        ? `<button onclick="markAsVIPSwap('${s.id}')">ðŸ”¥ Sell VIP</button>`
        : s.isVIP ? `<span style="color:crimson; font-weight:bold;">ðŸ”¥ VIP</span>` : '-';

      const isVerified = !!s.userId;

      const showVerifiedBadge = isVerified
        ? `<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>`
        : "";

      const showVIPBadge = s.isVIP
        ? `<span style="color:crimson; font-weight:bold; font-size: 0.85em; margin-left:6px;">
             <i class="fas fa-fire"></i> VIP Swap
           </span>` : "";

      const showBoostedBadge = s.isBoosted && s.boostExpiry
        ? `<span style="background:orange; color:white; font-size:0.75em; padding:2px 6px; border-radius:6px; margin-left:6px;">ðŸ”¥ Boosted</span>
           <span style="font-size: 0.75em; color:gray;">(${Math.ceil((s.boostExpiry - now) / (1000 * 60 * 60 * 24))} day${Math.ceil((s.boostExpiry - now) / (1000 * 60 * 60 * 24)) !== 1 ? 's' : ''} left)</span>`
        : "";

      const badges = `${showVerifiedBadge}${showVIPBadge}${showBoostedBadge}`;

      tr.innerHTML = `
        <tr>
          <td style="color:#2e7d32;">${s.teacherName} ${badges}</td>
          <td style="color:#3f51b5;">${s.county}</td>
          <td style="color:#009688;">${s.subCounty || '-'}</td>
          <td class="${blur ? 'blurred' : ''}" style="color:${blur ? '#aaa' : '#d32f2f'};">${blur ? 'Hidden' : s.phone}</td>
          <td class="${blur ? 'blurred' : ''}" style="color:${blur ? '#aaa' : '#6a1b9a'};">${blur ? 'Hidden' : s.subjectCombination}</td>
          <td style="color:#ef6c00;">${s.swapCounty}</td>
          <td style="color:#5d4037;">${s.swapSubCounty || '-'}</td>
          <td style="color:#1976d2;">${s.category}</td>
          <td style="color:#e91e63;">${s.hardship}</td>
          ${
            isAdmin
              ? `<td>
                  <button onclick="confirmDeleteSwap('${s.id}')"
                    style="background:#e53935; color:white; border:none; padding:4px 8px; border-radius:4px;">ðŸ—‘ï¸ Delete</button><br>
                  ${vipBtn}
                  <br>
                  <button onclick="boostMarketItem('${s.id}', '${s.teacherName}')"
                    style="margin-top:6px; background:#ff9800; color:white; border:none; border-radius:4px; padding:4px 8px; cursor:pointer;">
                    ðŸš€ Boost
                  </button>
                </td>`
              : `<td>${s.isVIP ? '<span style="color:crimson; font-weight:bold;">ðŸ”¥ VIP</span>' : '-'}</td>`
          }
          <td>
            <div class="rating" data-id="${s.id}">
              <span class="avg-rating" id="avgRating-${s.id}">Loading...</span><br>
              ${[1, 2, 3, 4, 5].map(star => `
                <i class="fas fa-star" onclick="rateService('${s.id}', ${star})"
                   style="cursor:pointer; color:#ccc;" id="star-${s.id}-${star}"></i>
              `).join('')}
            </div>
          </td>
        </tr>
      `;

      if (blur) {
        tr.querySelectorAll(".blurred").forEach(cell => {
          cell.style.cursor = "pointer";
          cell.title = "Click to unlock by payment";
          cell.onclick = showPaymentModal;
        });
      }

      tbody.appendChild(tr);
      updateAverageRating(s.id);
    }

  } catch (err) {
    console.error("Error loading swaps:", err);
    showCustomAlert("Error loading swaps: " + err.message, "error");
  }
}



// âœ… BOM Job Submit (Updated Format + Notifications)
document.getElementById("bomJobForm").addEventListener("submit", async e => {
  e.preventDefault();

  if (!currentUser) {
    return showCustomAlert("Please login to post a BOM job.", "error");
  }

  const now = new Date();
  const fullDate = now.toLocaleString();
  const email = currentUser.email || "unknown@user.com";
  const firstName = email.split("@")[0].split(/[._]/)[0];

  document.getElementById("bomDate").value = fullDate;
  document.getElementById("bomPostedBy").value = capitalize(firstName);

  const job = {
    organization: document.getElementById("bomOrg").value.trim(),
    jobType: document.getElementById("bomJobType").value.trim(),
    phone: document.getElementById("bomPhone").value.trim(),
    subCounty: document.getElementById("bomSubCounty").value,
    county: document.getElementById("bomCounty").value,
    salaryRange: document.getElementById("bomSalaryRange").value.trim(),
    datePosted: fullDate,
    postedBy: capitalize(firstName),
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  };

  try {
    await bomRef.add(job);
    showCustomAlert("âœ… BOM job posted successfully!", "success");
    document.getElementById("bomJobForm").reset();
    loadBOMJobs();

    // ðŸ”” Notify matching service providers
    notifyMatchingServiceProviders(job);

    // Notify Admin about the new job posting
    await db.collection("adminNotifications").add({
      type: "BOM Job Post",
      message: `New BOM job posted: ${job.jobType} by ${job.organization}, Salary: ${job.salaryRange}, Phone: ${job.phone}, County: ${job.county}`,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      read: false // âœ… Mark as unread for badge tracking
    });

  } catch (err) {
    showCustomAlert("âŒ Error posting job: " + err.message, "error");
  }
});

// âœ… Notify Matching Service Providers
function notifyMatchingServiceProviders(job) {
  servicesRef.get().then(snapshot => {
    snapshot.forEach(doc => {
      const service = doc.data();
      const occupationMatch = service.svcOccupation?.toLowerCase() === job.jobType.toLowerCase();
      const countyMatch = service.svcCounty === job.county;

      if (occupationMatch && countyMatch) {
        const message = `ðŸ›Ž Job Opportunity Matching Your Services!\nJob: ${job.jobType}\nPosted by: ${job.postedBy}\nPhone: ${job.phone}\nCounty: ${job.county}`;

        db.collection("notifications").add({
          userId: doc.id, // Or svcPhone as unique key
          message,
          timestamp: new Date()
        });
      }
    });
  });
}

// âœ… Utility to capitalize first letter
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

let bomJobsCache = [];
let jobToDeleteId = null;

// âœ… Load BOM Jobs with Boost Logic
async function loadBOMJobs() {
  const container = document.getElementById("jobContainer");
  container.innerHTML = "";

  try {
    const snapshot = await bomRef.orderBy("timestamp", "desc").get();
    const now = new Date();
    bomJobsCache = [];

    for (const doc of snapshot.docs) {
      const data = doc.data();
      const boostExpiry = data.boostExpiry?.toDate?.();
      const isBoosted = data.boosted && boostExpiry && boostExpiry > now;

      // â³ Auto-expire boost
      if (data.boosted && (!boostExpiry || boostExpiry <= now)) {
        await bomRef.doc(doc.id).update({ boosted: false, boostExpiry: null });
      }

      bomJobsCache.push({ id: doc.id, ...data, isBoosted, boostExpiry });
    }

    console.log("âœ… Loaded BOM Jobs:", bomJobsCache);
    renderBOMJobs(bomJobsCache);

  } catch (err) {
    showCustomAlert("âŒ Failed to load BOM jobs: " + err.message, "error");
  }
}

function renderBOMJobs(jobs) {
  const container = document.getElementById("jobContainer");
  container.innerHTML = "";

  if (!jobs.length) {
    container.innerHTML = `<p>ðŸŒðŸŒðŸŒðŸŒOpps No Jobs FoundðŸŒðŸŒðŸŒ</p>`;
    return;
  }

  jobs.forEach(job => {
    const card = document.createElement("div");
    card.className = "job-card";
    card.style.position = "relative";
    card.id = `bom-${job.id}`;

    const isPoster =
      typeof currentUser !== "undefined" &&
      currentUser !== null &&
      (job.postedBy === currentUser.email || job.postedBy === currentUser.displayName);

    const isVerified = job.postedBy !== undefined && job.postedBy !== null;

    const badge = isVerified
      ? `<div class="verified-badge"><i class="fas fa-check-circle"></i> Verified</div>`
      : "";

    const salaryIcon = '<i class="fas fa-dollar-sign" style="margin-right: 8px;"></i>';
    const locationIcon = '<i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i>';
    const phoneIcon = '<i class="fas fa-phone-alt" style="margin-right: 8px;"></i>';
    const dateIcon = '<i class="fas fa-calendar-day" style="margin-right: 8px;"></i>';

    let boostBadge = "";
    if (job.isBoosted && job.boostExpiry) {
      const daysLeft = Math.ceil((job.boostExpiry - new Date()) / (1000 * 60 * 60 * 24));
      boostBadge = `
        <span style="background: orange; color: white; font-size: 0.75em; padding: 2px 6px; border-radius: 6px;">
          ðŸ”¥ Boosted
        </span>
        <span style="color: gray; font-size: 0.75em;">(${daysLeft} day${daysLeft !== 1 ? "s" : ""} left)</span>
      `;
    }

    card.innerHTML = `
      ${badge}
      <h3 style="color:#2e7d32;">Occupation: ${job.jobType} ${boostBadge}</h3>

      <p style="color:#3f51b5;"><strong>Organization:</strong> ${job.organization}</p>

      <p style="color:#009688;">
        <strong>${phoneIcon}Phone:</strong> 
        <a href="tel:${job.phone}" style="color:green;">ðŸ“ž Call</a><br>
        <a href="https://wa.me/254${job.phone.replace(/^0/, '')}" target="_blank" style="color:#25D366;">ðŸ’¬ WhatsApp</a>
      </p>

      <p style="color:#e91e63;"><strong>${locationIcon}Location:</strong> ${job.county}, ${job.subCounty}</p>

      <p style="color:#ff9800;"><strong>${salaryIcon}Salary Range:</strong> KES ${parseInt(job.salaryRange).toLocaleString()}</p>

      <p style="color:#6a1b9a;"><strong>${dateIcon}Date Posted:</strong> ${job.datePosted}</p>

      <p style="color:#795548;"><strong>Posted By:</strong> ${job.postedBy || "Unknown"}</p>

      <div style="margin-top: 10px;">
        ${
          !isPoster
            ? `<button onclick="openChatModal('${job.phone}', '${job.organization}')"
                 style="background:#673ab7; color:white; border:none; border-radius:5px; padding:6px 12px; cursor:pointer;">
                 ðŸ’¬ Chat
               </button>`
            : `
              <button onclick="confirmDeleteBOMJob('${job.id}')"
                 style="background:#dc3545; color:white; border:none; border-radius:5px; padding:6px 12px; cursor:pointer;">
                 ðŸ—‘ï¸ Delete
              </button>
              <button onclick="showPaymentModalFor('job', 1000, '${job.id}', '${job.jobType}')"
                 style="background:#ff9800; color:white; border:none; border-radius:5px; padding:6px 12px; margin-left:6px; cursor:pointer;">
                 ðŸš€ Boost
              </button>
            `
        }
      </div>

      <div class="rating" data-id="${job.id}" style="margin-top: 10px;">
        <span class="avg-rating" id="avgRating-${job.id}">Loading...</span><br>
        ${[1, 2, 3, 4, 5].map(star => `
          <i class="fas fa-star" onclick="rateService('${job.id}', ${star})"
             style="cursor:pointer; color:#ccc;" id="star-${job.id}-${star}"></i>
        `).join('')}
      </div>
    `;

    container.appendChild(card);
    updateAverageRating(job.id);
  });
}

// âœ… Delete BOM Job
async function confirmDeleteBOMJob(jobId) {
  if (confirm("Are you sure you want to delete this job posting?")) {
    try {
      await bomRef.doc(jobId).delete();
      showCustomAlert("âœ…  job deleted successfully!", "success");
      loadBOMJobs(); // Refresh the job listings
    } catch (err) {
      showCustomAlert("âŒ Failed to delete job: " + err.message, "error");
    }
  }
}

// âœ… Update Average Rating
async function updateAverageRating(jobId) {
  const ratingRef = db.collection("ratings").where("jobId", "==", jobId);
  const snapshot = await ratingRef.get();

  let totalRating = 0;
  let totalReviews = snapshot.size;

  snapshot.forEach(doc => {
    totalRating += doc.data().rating;
  });

  const avgRating = totalReviews ? (totalRating / totalReviews).toFixed(1) : 0;
  const avgRatingElement = document.getElementById(`avgRating-${jobId}`);

  avgRatingElement.textContent = `â­ ${avgRating} (${totalReviews} Reviews)`;
}



// âœ… BOM Job Filters (Optional)
function applyBOMFilters() {
  const jobType = document.getElementById("filterJobType")?.value.toLowerCase() || "";
  const county = document.getElementById("filterCounty")?.value || "";
  const subcounty = document.getElementById("filterSubCounty")?.value || "";
  const minSalary = parseInt(document.getElementById("filterSalary")?.value) || 0;

  const filtered = bomJobsCache.filter(job => {
    return (
      (!jobType || job.jobType.toLowerCase().includes(jobType)) &&
      (!county || job.county === county) &&
      (!subcounty || job.subCounty === subcounty) &&
      (!minSalary || parseInt(job.salaryRange) >= minSalary)
    );
  });

  renderBOMJobs(filtered);
}

// âœ… Populate Sub-county Based on County
function handleCountyChange(countyId, subCountyId) {
  const county = document.getElementById(countyId).value;
  const subCountyEl = document.getElementById(subCountyId);
  subCountyEl.innerHTML = `<option value="">All Sub-counties</option>`;
  if (countySubCountyMap[county]) {
    countySubCountyMap[county].forEach(sub => {
      const option = document.createElement("option");
      option.value = sub;
      option.textContent = sub;
      subCountyEl.appendChild(option);
    });
  }
}

// âœ… Delete BOM Job
function confirmDeleteBOMJob(jobId) {
  jobToDeleteId = jobId;
  document.getElementById("confirmDeleteModal").style.display = "flex";
}
function closeDeleteModal() {
  jobToDeleteId = null;
  document.getElementById("confirmDeleteModal").style.display = "none";
}

document.getElementById("confirmDeleteBtn").onclick = async () => {
  if (!jobToDeleteId) return;

  try {
    await bomRef.doc(jobToDeleteId).delete();
    showCustomAlert("ðŸ—‘ï¸ BOM job deleted successfully!", "success");
    closeDeleteModal();
    loadBOMJobs();
  } catch (err) {
    showCustomAlert("âŒ Failed to delete: " + err.message, "error");
  }
};

  // âœ… Alert Helper
  function showCustomAlert(msg, type = "info") {
    const el = document.createElement("div");
    el.className = "alert";
    el.style.backgroundColor = type === "error" ? "#f44336" : "#4CAF50";
    el.textContent = msg;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
  }

  // âœ… Load home page first
  attachServiceFormSubmit();  // âœ… Call this ONCE
showPage("home");

 // âœ… Alert Utility
  function showCustomAlert(msg, type = "info") {
    const el = document.createElement("div");
    el.className = "alert";
    el.style.backgroundColor = type === "error" ? "#f44336" : "#4CAF50";
    el.textContent = msg;
    document.body.appendChild(el);
    setTimeout(() => el.remove(), 3000);
  }
document.getElementById("resourceForm").addEventListener("submit", async e => {
  e.preventDefault();
  if (!isLoggedIn) return showCustomAlert("Please login to upload resources.", "error");

  const file = document.getElementById("resourceFile").files[0];
  const title = document.getElementById("resourceTitle").value.trim();
  const price = document.getElementById("resourcePrice").value.trim();

  if (!file || !title || !price) return showCustomAlert("All fields required.", "error");

  const filePath = `resources/${Date.now()}_${file.name}`;
  const uploadTask = await storage.ref(filePath).put(file);
  const downloadURL = await uploadTask.ref.getDownloadURL();

  await resourceRef.add({
    title,
    price,
    downloadURL,
    filePath,
    uploadedBy: currentUser.uid,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  });

  showCustomAlert("âœ… Resource uploaded!", "success");
  document.getElementById("resourceForm").reset();
  loadResources();
});
async function loadResources() {
  const tbody = document.querySelector("#resourcesTable tbody");
  tbody.innerHTML = "";

  const snapshot = await resourceRef.orderBy("timestamp", "desc").get();
  if (snapshot.empty) {
    tbody.innerHTML = `<tr><td colspan="3">No resources yet.</td></tr>`;
    return;
  }

  snapshot.forEach(doc => {
    const data = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${data.title}</td>
      <td>${data.price}</td>
 <td>
  ${isAdmin ? `<a href="${data.downloadURL}" target="_blank">Download</a>` :
    hasPaid ? `<a href="${data.downloadURL}" target="_blank">Download</a>` :
    `<button onclick="showPaymentModal()">Pay to Download</button>`}
</td>
`;
    tbody.appendChild(tr);
  });
}
// âœ… Populate counties for soulmate form
["smCounty", "smWorkCounty"].forEach(populateCounties);

document.getElementById("soulmateForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!currentUser) {
    showCustomAlert("Please login to post your profile.", "error");
    return;
  }

  const ageValue = parseInt(document.getElementById("smAge").value.trim());
  if (isNaN(ageValue) || ageValue < 18) {
    showCustomAlert("You must be 18 years or older to submit a soulmate profile.", "error");
    return;
  }

  const photoFile = document.getElementById("smPhoto").files[0];
  let photoURL = "default.jpg"; // ðŸ–¼ï¸ fallback image

  try {
    if (photoFile) {
      // ðŸ”¼ Upload photo to Firebase Storage
      const photoPath = `soulmatePhotos/${Date.now()}_${photoFile.name}`;
      const photoSnap = await storage.ref(photoPath).put(photoFile);
      photoURL = await photoSnap.ref.getDownloadURL();
    }

    // ðŸ”½ Prepare form data
    const data = {
      name: document.getElementById("smName").value.trim(),
      county: document.getElementById("smCounty").value,
      subCounty: document.getElementById("smSubCounty").value,
      age: ageValue,
      tribe: document.getElementById("smTribe").value.trim(),
      sex: document.getElementById("smSex").value,
      occupation: document.getElementById("smOccupation").value.trim(),
      workCounty: document.getElementById("smWorkCounty").value,
      phone: document.getElementById("smPhone").value.trim(),
      status: document.getElementById("smStatus").value,
      kids: document.getElementById("smKids").value,
      photoURL,
      postedBy: currentUser.uid,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    };

    // âœ… Save to Firestore
    await soulmateRef.add(data);
    showCustomAlert("âœ… Profile submitted!", "success");
    document.getElementById("soulmateForm").reset();
    loadSoulmates();

    // âœ… Notify Admin
    await db.collection("adminNotifications").add({
      type: "Soulmate Profile",
      message: `New soulmate profile posted: ${data.name}, Age: ${data.age}, Phone: ${data.phone}`,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      read: false
    });

  } catch (err) {
    console.error("Error uploading soulmate:", err);
    showCustomAlert("Error saving profile: " + err.message, "error");
  }
});

async function loadSoulmates() {
  const container = document.querySelector("#soulmateContainer");
  container.innerHTML = "";

  const minAge = parseInt(document.getElementById("filterMinAge")?.value || 0);
  const maxAge = parseInt(document.getElementById("filterMaxAge")?.value || 100);
  const tribeFilter = document.getElementById("filterTribe")?.value.toLowerCase().trim() || "";
  const sexFilter = document.getElementById("filterSex")?.value || "";

  const snapshot = await soulmateRef.orderBy("timestamp", "desc").get();
  if (snapshot.empty) {
    container.innerHTML = `
      <div style="text-align:center; padding:30px 10px; color:#777;">
        <p style="font-size:18px;">ðŸ’” No soulmate profiles found</p>
        <p style="font-size:14px;">Make your goods be viewed by thousands of our users who visit our site.</p>
      </div>
    `;
    return;
  }

  let matchFound = false;
  const hasAccess = typeof checkAccess === 'function' ? checkAccess("soulmate") : false;

  snapshot.forEach(doc => {
    const d = doc.data();
    const id = doc.id;

    const age = parseInt(d.age) || 0;
    const matchesAge = age >= minAge && age <= maxAge;
    const matchesTribe = tribeFilter === "" || (d.tribe && d.tribe.toLowerCase().includes(tribeFilter));
    const matchesSex = sexFilter === "" || d.sex === sexFilter;

    if (!matchesAge || !matchesTribe || !matchesSex) return;

    matchFound = true;

    const isPoster =
      typeof currentUser !== "undefined" &&
      currentUser !== null &&
      (d.postedBy === currentUser.email || d.postedBy === currentUser.displayName);

    const isVerified = d.postedBy !== undefined && d.postedBy !== null && d.postedBy !== "";

    const verifiedBadge = isVerified
      ? `<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>`
      : "";

    const card = document.createElement("div");
    card.className = "soulmate-card";
    card.style.position = "relative";

    let sexIcon = '';
    if (d.sex === 'Male') {
      sexIcon = '<i class="fas fa-mars" style="margin-right: 8px; color:#00796b;"></i>';
    } else if (d.sex === 'Female') {
      sexIcon = '<i class="fas fa-venus" style="margin-right: 8px; color:#00796b;"></i>';
    }

    let statusIcon = '';
    if (d.status === 'Single') {
      statusIcon = '<i class="fas fa-heart-broken" style="margin-left: 8px; color:#f44336;"></i>';
    } else if (d.status === 'Married') {
      statusIcon = '<i class="fas fa-ring" style="margin-left: 8px; color:#00796b;"></i>';
    }

    // ðŸ” CONTACT SECTION
    let contactSection = '';
    if (isPoster || hasAccess) {
      contactSection = `
        <div class="contact-actions">
          <a href="tel:${d.phone}" style="color:green;">ðŸ“ž Call</a><br>
          <a href="https://wa.me/254${d.phone.replace(/^0/, '')}" target="_blank" style="color:#25D366;">ðŸ’¬ WhatsApp</a><br>
          ${
            !isPoster ? `
              <button onclick="openChatModal('${d.phone}', '${d.name}')"
                style="background:#673ab7; color:white; border:none; border-radius:5px; padding:6px 12px; cursor:pointer;">
                ðŸ’¬ Chat
              </button>` : ''
          }
        </div>
      `;
    } else {
      contactSection = `
        <div class="contact-actions" style="margin-top:10px;">
          <p style="color:gray;">ðŸ”’ Contact info locked</p>
          <button onclick="showPaymentModalFor('soulmate', 250, currentUser?.uid || 'guest', 'Unlock Soulmate Contacts')"
            style="background:#4CAF50; color:white; border:none; border-radius:5px; padding:6px 12px;">
            ðŸ”“ Unlock Contacts
          </button>
        </div>
      `;
    }

    card.innerHTML = `
      ${verifiedBadge}
      <div class="soulmate-photo">
        <img src="${d.photoURL || 'default.jpg'}" alt="Photo" style="width:100%; height:auto; border-radius:8px; object-fit:cover;" />
      </div>
      <div class="soulmate-details">
        <h3 style="color:#00796b; display: flex; align-items: center;">
          ${sexIcon}${d.name} ${statusIcon}
        </h3>

        <p style="color:#ff5722;"><i class="fas fa-birthday-cake" style="margin-right: 8px;"></i><strong>Age:</strong> ${d.age}</p>
        <p style="color:#3f51b5;"><i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i><strong>County:</strong> ${d.county}</p>
        <p style="color:#8e24aa;"><i class="fas fa-users" style="margin-right: 8px;"></i><strong>Tribe:</strong> ${d.tribe}</p>
        <p style="color:#009688;"><i class="fas fa-briefcase" style="margin-right: 8px;"></i><strong>Occupation:</strong> ${d.occupation}</p>
        <p style="color:#e91e63;"><i class="fas fa-heart" style="margin-right: 8px;"></i><strong>Status:</strong> ${d.status || 'â€”'}</p>
        <p style="color:#795548;"><i class="fas fa-baby" style="margin-right: 8px;"></i><strong>Kids:</strong> ${d.kids || 'â€”'}</p>

        ${contactSection}
      </div>

      <div class="rating" data-id="${id}">
        <span class="avg-rating" id="avgRating-${id}">Loading...</span><br>
        ${[1, 2, 3, 4, 5].map(star => `
          <i class="fas fa-star" onclick="rateService('${id}', ${star})"
             style="cursor:pointer; color:#ccc;" id="star-${id}-${star}"></i>
        `).join('')}
      </div>
    `;

    container.appendChild(card);
    updateAverageRating(id);
  });

  if (!matchFound) {
    container.innerHTML = `
      <div style="text-align:center; padding:30px 10px; color:#999;">
        <p style="font-size:16px;">ðŸ” No results match your filter</p>
      </div>
    `;
  }
}
function checkAccess(type) {
  const expiry = localStorage.getItem(`${type}AccessExpiry`);
  return expiry && new Date() < new Date(expiry);
}



function boostMarketItem(itemId) {
  const confirmBoost = confirm("Boost this item for Ksh 100? Your item will be promoted for 7 days.");
  if (!confirmBoost) return;

  alert("âœ… Payment simulated. Boosting now...");

  const boostExpiry = new Date();
  boostExpiry.setDate(boostExpiry.getDate() + 7);

  marketRef.doc(itemId).update({
    boosted: true,
    boostExpiry: firebase.firestore.Timestamp.fromDate(boostExpiry)
  }).then(() => {
    showCustomAlert("ðŸš€ Item boosted successfully!", "success");
    loadMarketItems();
  }).catch(err => {
    showCustomAlert("âŒ Boost failed: " + err.message, "error");
  });
}



function showSoulmateModal(data) {
  const photo = data.photoURL || 'default.jpg';

  // ðŸ‘€ Conditionally show phone only if paid
  const phoneSection = hasPaid || isAdmin ? `
    <p><strong>Phone:</strong> 
      <a href="tel:${data.phone}" style="color:green;">${data.phone}</a><br>
      <a href="https://wa.me/254${data.phone.replace(/^0/, '')}" target="_blank" style="color:#25D366;">WhatsApp</a>
    </p>
  ` : `
    <p><strong>Phone:</strong> <span style="color:crimson;">Locked â€” <a href="#" onclick="showPaymentModal()">Unlock Now</a></span></p>
  `;

  const detailHTML = `
    <p style="text-align:center;">
      <img src="${photo}" alt="Photo of ${data.name}" 
           style="max-width:90px; height:90px; border-radius:50%; object-fit:cover; border:4px solid #e91e63; box-shadow: 0 0 8px #e91e63;">
    </p>
    <p><strong>Name:</strong> ${data.name}</p>
    <p><strong>County:</strong> ${data.county}</p>
    <p><strong>Age:</strong> ${data.age}</p>
    <p><strong>Tribe:</strong> ${data.tribe}</p>
    <p><strong>Sex:</strong> ${data.sex}</p>
    <p><strong>Occupation:</strong> ${data.occupation}</p>
    <p><strong>Work County:</strong> ${data.workCounty}</p>
    <p><strong>Marital Status:</strong> ${data.status || 'Not specified'}</p>
    <p><strong>Has Kids:</strong> ${data.kids || 'Not specified'}</p>
    ${phoneSection}
    <div style="text-align:center; margin-top:10px;">
      <button onclick="sendInterest('${data.name}')" style="padding:8px 14px; background:#ff4081; border:none; border-radius:5px; color:#fff; cursor:pointer;">
        â¤ï¸ Send Interest
      </button>
    </div>
  `;

  document.getElementById("soulmateDetails").innerHTML = detailHTML;
  document.getElementById("soulmateModal").style.display = "block";
}
async function sendInterest(toName) {
  if (!isLoggedIn || !currentUser) {
    showCustomAlert("Please login to send interest.", "error");
    return;
  }

  try {
    await db.collection("soulmateInterests").add({
      fromUserId: currentUser.uid,
      fromName: currentUser.displayName || currentUser.email,
      toName,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    showCustomAlert(`â¤ï¸ Interest sent to ${toName}!`, "success");
  } catch (err) {
    showCustomAlert("Error sending interest: " + err.message, "error");
  }
}
async function isMutualMatch(name) {
  const myName = currentUser.displayName || currentUser.email;

  const sent = await db.collection("soulmateInterests")
    .where("fromUserId", "==", currentUser.uid)
    .where("toName", "==", name).get();

  const received = await db.collection("soulmateInterests")
    .where("fromName", "==", name)
    .where("toName", "==", myName).get();

  return !sent.empty && !received.empty;
}
let chatPartner = null;
let chatConversationId = '';

// Generate consistent conversation ID
function getConversationId(userA, userB) {
  return [userA, userB].sort().join("_");
}

function openChatModal(partnerUid, partnerName, isGroup = false) {
  chatPartner = { uid: partnerUid, name: partnerName };
  chatConversationId = getConversationId(currentUser.uid, partnerUid);

  localStorage.setItem('currentConvoId', chatConversationId);
  showPage("messages");
  document.getElementById("chatWith").textContent = isGroup ? `Group: ${partnerName}` : `Chatting with ${partnerName}`;
  listenForMessages(chatConversationId);
}

function closeChat() {
  chatConversationId = '';
  chatPartner = null;
  document.getElementById("chatMessages").innerHTML = '';
  document.getElementById("chatWith").textContent = 'No active chat';
  showPage('chatListPage');
}

// Date label helper
function getFriendlyDate(date) {
  if (!date) return '';
  const now = new Date();
  const d = new Date(date);
  const isToday = d.toDateString() === now.toDateString();

  const yesterday = new Date();
  yesterday.setDate(now.getDate() - 1);
  const isYesterday = d.toDateString() === yesterday.toDateString();

  if (isToday) return "Today";
  if (isYesterday) return "Yesterday";

  return d.toLocaleDateString();
}

// Listen for messages + typing + render bubbles
function listenForMessages(convoId) {
  const container = document.getElementById("chatMessages");
  container.innerHTML = '';
  const sound = new Audio("https://notificationsounds.com/notification-sounds/eventually-590/download/mp3");
  let lastDate = '';

  db.collection("messages").doc(convoId).collection("chats")
    .orderBy("timestamp")
    .onSnapshot(snapshot => {
      snapshot.docChanges().forEach(async change => {
        const doc = change.doc;
        const d = doc.data();
        const isMe = d.fromUid === currentUser.uid;
        const messageId = doc.id;
        const timeString = d.timestamp ? new Date(d.timestamp.toDate()).toLocaleTimeString() : 'Sent';
        const dateString = d.timestamp ? new Date(d.timestamp.toDate()).toDateString() : '';

        // Insert date separator
        if (lastDate !== dateString) {
          const dateDiv = document.createElement("div");
          dateDiv.className = "date-separator";
          dateDiv.textContent = getFriendlyDate(d.timestamp?.toDate());
          container.appendChild(dateDiv);
          lastDate = dateString;
        }

        if (change.type === "added" && !document.getElementById(`msg-${messageId}`)) {
          const readIcon = d.read ? 'âœ”âœ”' : 'âœ”';
          const readColor = d.read ? 'green' : '#aaa';
          let content = d.type === 'image'
            ? `<img src="${d.content}" style="max-width: 200px; border-radius: 8px;" />`
            : `<div class="chat-text">${d.content}</div>`;

          const chatBubble = document.createElement("div");
          chatBubble.id = `msg-${messageId}`;
          chatBubble.className = `chat-bubble ${isMe ? 'right' : 'left'}`;
          chatBubble.innerHTML = `
            <div class="chat-avatar">${(d.fromName || 'U')[0]}</div>
            <div class="chat-content">
              <div class="chat-name">${d.fromName}</div>
              ${content}
              <div class="chat-time">
                ${timeString}
                ${isMe ? `<span style="color:${readColor}; font-size:12px;"> ${readIcon}</span>` : ''}
              </div>
              ${isMe && d.type === "text" ? `<button onclick="deleteMessage('${convoId}', '${messageId}', this)" style="margin-top:5px;">ðŸ—‘</button>` : ''}
            </div>
          `;
          container.appendChild(chatBubble);

          if (!isMe && !d.read) {
            await doc.ref.update({ read: true });
            sound.play();
          }
        }

        if (change.type === "modified") {
          const chatBubble = document.getElementById(`msg-${messageId}`);
          if (chatBubble) {
            chatBubble.querySelector(".chat-time").textContent = timeString;
          }
        }
      });

      container.scrollTop = container.scrollHeight;
    });

  // Typing indicator
  db.collection("messages").doc(convoId)
    .onSnapshot(doc => {
      const data = doc.data();
      const typing = data?.typing;
      const indicator = document.getElementById("typingIndicator");
      if (typing && typing !== currentUser.displayName) {
        indicator.textContent = `${typing} is typing...`;
      } else {
        indicator.textContent = '';
      }
    });
}

// Show typing status
function handleTyping() {
  if (!chatConversationId) return;
  const name = currentUser.displayName || currentUser.email;
  db.collection("messages").doc(chatConversationId).set({ typing: name }, { merge: true });

  clearTimeout(window.typingTimeout);
  window.typingTimeout = setTimeout(() => {
    db.collection("messages").doc(chatConversationId).set({ typing: "" }, { merge: true });
  }, 2000);
}

// Notification badge
function updateNotificationBadge(unreadCount) {
  const badge = document.getElementById('notifBadge');
  if (!badge) return;
  badge.style.display = unreadCount > 0 ? 'inline' : 'none';
  badge.textContent = unreadCount;
}

document.querySelector('#notifBadge')?.addEventListener('click', function () {
  const convoId = getCurrentConvoId();
  showPage('messages');
  listenForMessages(convoId);
  resetUnreadCount(convoId);
});

function getCurrentConvoId() {
  return localStorage.getItem('currentConvoId');
}

function resetUnreadCount(convoId) {
  db.collection("users")
    .doc(currentUser.uid)
    .collection("conversations")
    .doc(convoId)
    .update({ unreadCount: 0 })
    .then(() => updateNotificationBadge(0));
}

// Load my chat list
function showMyChats() {
  showPage('chatListPage');
  const currentUserUid = currentUser.uid;

  db.collection("users").doc(currentUserUid).collection("conversations")
    .orderBy("lastTimestamp", "desc")
    .get()
    .then(snapshot => {
      const container = document.getElementById('chatListContainer');
      container.innerHTML = '';

      snapshot.forEach(doc => {
        const data = doc.data();
        const chatPartnerName = data.partnerName;
        const chatPartnerUid = data.partnerUid;

        const chatItem = document.createElement('div');
        chatItem.className = 'chat-item';
        chatItem.style = "padding:10px; border-bottom:1px solid #ccc; cursor:pointer; font-weight:bold;";
        chatItem.textContent = chatPartnerName;

        chatItem.onclick = () => {
          openChatModal(chatPartnerUid, chatPartnerName);
        };

        container.appendChild(chatItem);
      });
    })
    .catch(err => {
      console.error("Error loading chats:", err);
    });
}

// Send text or image message
async function sendChatMessage(type = 'text') {
  const input = document.getElementById("chatInput");
  const fileInput = document.getElementById("mediaInput");
  const msg = input.value.trim();
  let content = '';

  // Handle sending image
  if (type === 'image') {
    const file = fileInput.files[0];
    if (!file) return;

    // Upload the image to Firebase Storage
    const storageRef = firebase.storage().ref(`chat_media/${Date.now()}_${file.name}`);
    await storageRef.put(file);
    content = await storageRef.getDownloadURL(); // Get the URL of the uploaded image
  } else if (msg) {
    content = msg; // If it's a text message, use the input value
  }

  // Ensure that we have a valid chat partner and conversation
  if (!content || !chatPartner || !currentUser || !chatConversationId) return;

  const fromName = currentUser.displayName || currentUser.email;
  const fromUid = currentUser.uid;
  const toName = chatPartner.name;
  const toUid = chatPartner.uid;
  const timestamp = firebase.firestore.FieldValue.serverTimestamp();

  try {
    // Add the message to Firestore
    await db.collection("messages").doc(chatConversationId).collection("chats").add({
      from: fromName,
      fromUid,
      fromName,
      to: toName,
      toUid,
      type,
      content,
      read: false,
      timestamp
    });

    // Reset input fields and preview
    input.value = '';
    input.focus();
    fileInput.value = '';
    document.getElementById('imagePreviewContainer').style.display = 'none'; // Hide preview
    previewFile = null; // Reset the preview file

    // Reset typing status
    db.collection("messages").doc(chatConversationId).set({ typing: "" }, { merge: true });

    showCustomAlert("ðŸ“¤ Message sent!", "success");

    // Update conversation metadata for sender
    await db.collection("users").doc(fromUid).collection("conversations").doc(chatConversationId).set({
      partnerUid: toUid,
      partnerName: toName,
      partnerPhotoUrl: chatPartner.photoURL || "",
      lastMessage: type === 'image' ? "[Image]" : msg,
      lastTimestamp: timestamp
    }, { merge: true });

    // Update conversation metadata for receiver
    await db.collection("users").doc(toUid).collection("conversations").doc(chatConversationId).set({
      partnerUid: fromUid,
      partnerName: fromName,
      partnerPhotoUrl: currentUser.photoURL || "",
      lastMessage: type === 'image' ? "[Image]" : msg,
      lastTimestamp: timestamp,
      unreadCount: firebase.firestore.FieldValue.increment(1)
    }, { merge: true });

  } catch (error) {
    console.error("âŒ Error sending message:", error);
    showCustomAlert("âŒ Failed to send message. Try again.", "error");
  }
}


// Auto listen globally for new incoming threads
function listenForIncomingMessages() {
  const myUid = currentUser.uid;

  db.collection("messages").onSnapshot(snapshot => {
    snapshot.docChanges().forEach(change => {
      if (change.type === "added") {
        const chatId = change.doc.id;

        change.doc.ref.collection("chats")
          .where("toUid", "==", myUid)
          .where("read", "==", false)
          .limit(1)
          .get()
          .then(chatSnap => {
            if (!chatSnap.empty) {
              const msg = chatSnap.docs[0].data();
              if (chatConversationId !== chatId) {
                openChatModal(msg.fromUid, msg.fromName);
              }
            }
          });
      }
    });
  });
}


isMutualMatch(data.name).then(isMatch => {
  if (isMatch) {
    document.getElementById("soulmateDetails").innerHTML += `
      <div style="text-align:center; margin-top:10px;">
        <button onclick="openChatModal('${data.name}')" style="padding:8px 14px; background:#673ab7; color:#fff; border:none; border-radius:5px;">
          ðŸ’¬ Open Chat
        </button>
      </div>
    `;
  }
});


function closeSoulmateModal() {
  document.getElementById("soulmateModal").style.display = "none";
}

  // âœ… Populate counties
  populateCounties("svcCounty");
  populateCounties("filterCounty");
// âœ… Attach Submit Logic Once
function attachServiceFormSubmit() {
  const form = document.getElementById("serviceForm");
  form.addEventListener("submit", submitServiceHandler);
}

// âœ… Default Submit Handler
async function submitServiceHandler(e) {
  e.preventDefault();
  if (!isLoggedIn || !currentUser) {
    showPage("login");
    return alert("You must be logged in.");
  }

  const data = {
    name: document.getElementById("svcName").value.trim(),
    county: document.getElementById("svcCounty").value,
    subcounty: document.getElementById("svcSubCounty").value.trim(),
    occupation: document.getElementById("svcOccupation").value.trim(),
    experience: document.getElementById("svcExperience").value,
    phone: document.getElementById("svcPhone").value.trim(),
    postedBy: currentUser.uid,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  };

  if (Object.values(data).some(v => !v)) {
    return alert("Please fill all fields.");
  }

  try {
    // âœ… Save service to Firestore
    await servicesRef.add(data);
    showCustomAlert("âœ… Service posted!", "success");
    document.getElementById("serviceForm").reset();
    loadServices();

await db.collection("adminNotifications").add({
  type: "Marketplace Post",
  message: `New item posted: ${itemName} (${itemCategory}), Price: ${itemPrice}, Phone: ${itemPhone}, County: ${itemCounty}`,
  timestamp: firebase.firestore.FieldValue.serverTimestamp(),
  read: false // âœ… Mark as unread for badge tracking
});


  } catch (err) {
    showCustomAlert("âŒ Error: " + err.message, "error");
  }
}
async function loadServices() {
  const container = document.getElementById("servicesContainer");
  container.innerHTML = "";

  const snapshot = await servicesRef.orderBy("timestamp", "desc").get();
  if (snapshot.empty) {
    container.innerHTML = `<p>No services posted yet.</p>`;
    return;
  }

  const now = new Date();

  snapshot.forEach(async doc => {
    const d = doc.data();
    const id = doc.id;

    const boostExpiry = d.boostExpiry?.toDate?.();
    const isBoosted = d.boosted && boostExpiry && boostExpiry > now;

    if (d.boosted && (!boostExpiry || boostExpiry <= now)) {
      await servicesRef.doc(id).update({ boosted: false, boostExpiry: null });
    }

    const isPoster = currentUser?.uid === d.postedBy;
    const isAdminUser = isAdmin;
    const isVerified = !!d.postedBy;

    const verifiedBadge = isVerified
      ? `<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>`
      : "";

    let boostBadge = "";
    if (isBoosted && boostExpiry) {
      const daysLeft = Math.ceil((boostExpiry - now) / (1000 * 60 * 60 * 24));
      boostBadge = `
        <span style="background: orange; color: white; font-size: 0.75em; padding: 2px 6px; border-radius: 6px; margin-left: 6px;">ðŸ”¥ Boosted</span>
        <span style="color: gray; font-size: 0.75em;">(${daysLeft} day${daysLeft !== 1 ? "s" : ""} left)</span>
      `;
    }

    const card = document.createElement("div");
    card.className = "service-card";
    card.id = `service-${id}`;
    card.dataset.county = d.county;
    card.dataset.occupation = d.occupation.toLowerCase();
    card.style.position = "relative";

    const experienceIcon = '<i class="fas fa-briefcase" style="margin-right: 8px;"></i>';
    const locationIcon = '<i class="fas fa-map-marker-alt" style="margin-right: 8px;"></i>';
    const phoneIcon = '<i class="fas fa-phone-alt" style="margin-right: 8px;"></i>';
    const whatsappIcon = '<i class="fab fa-whatsapp" style="margin-right: 8px;"></i>';

    card.innerHTML = `
      ${verifiedBadge}
      <p style="color:#00796b;"><strong>Name:</strong> ${d.name} ${boostBadge}</p>
      <p style="color:#3f51b5;"><strong>${locationIcon}County:</strong> ${d.county}</p>
      <p style="color:#d32f2f;"><strong>Occupation:</strong> <span class="highlight-occupation">${d.occupation}</span></p>
      <p style="color:#6a1b9a;"><strong>${experienceIcon}Experience:</strong> ${d.experience} years</p>
      <p style="color:#2e7d32;"><strong>${phoneIcon}Phone:</strong> 
        <a href="tel:${d.phone}" style="color:green;">ðŸ“ž Call</a>
      </p>

      <div class="rating" data-id="${id}" style="margin: 4px 0;">
        <span class="avg-rating" id="avgRating-${id}">Loading...</span><br>
        <span>
          ${[1, 2, 3, 4, 5].map(star => `
            <i class="fas fa-star" onclick="rateService('${id}', ${star})"
              style="cursor:pointer; color:#ccc;" id="star-${id}-${star}"></i>
          `).join('')}
        </span>
      </div>

      <p style="color:#007bff;"><strong>${phoneIcon}<a href="tel:${d.phone}" style="color:green;">ðŸ“ž Call</a></strong></p>
      <p style="color:#25D366;"><strong>${whatsappIcon}<a href="https://wa.me/254${d.phone.replace(/^0/, '')}" target="_blank">ðŸ’¬ WhatsApp</a></strong></p>

      ${
        !isPoster ? `
          <button onclick="openChatModal('${d.phone}', '${d.name}')" 
            style="margin-top:4px; background:#673ab7; color:white; border:none; border-radius:4px; padding:4px 8px; cursor:pointer;">
            ðŸ’¬ Chat
          </button><br>
        ` : ''
      }

      ${
        (isPoster || isAdminUser) ? `
          <div style="margin-top:6px;">
            <button onclick="deleteService('${id}')" 
              style="background:#e53935; color:white; border:none; padding:4px 8px; border-radius:4px;">ðŸ—‘ï¸ Delete</button>

            <button onclick='editService(${JSON.stringify(d)}, "${id}")' 
              style="background:#0288d1; color:white; border:none; padding:4px 8px; border-radius:4px; margin-left:4px;">âœï¸ Edit</button>

            <button onclick="boostMarketItem('${id}', '${d.name}')" 
              style="background:#ff9800; color:white; border:none; padding:4px 8px; border-radius:4px; margin-left:4px;">ðŸš€ Boost</button>
          </div>
        ` : ''
      }
    `;

    container.appendChild(card);
    updateAverageRating(id);
  });
}


// âœ… Show toast message (success or error)
function showToast(message, type = "success") {
  Toastify({
    text: message,
    duration: 3000,
    gravity: "top",
    position: "right",
    backgroundColor: type === "success" ? "#28a745" : "#dc3545",
    close: true,
  }).showToast();
}

function promptToast(message, onConfirm) {
  // Remove any existing prompt
  const oldBox = document.getElementById("customConfirmBox");
  if (oldBox) oldBox.remove();

  const box = document.createElement("div");
  box.id = "customConfirmBox"; // important for duplicate removal
  box.innerHTML = `
    <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:9999;">
      <div style="background:#fff;padding:20px 30px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.3);text-align:center;font-family:sans-serif;">
        <p style="margin-bottom:20px;font-size:16px;">${message}</p>
        <button id="promptYesBtn" style="margin-right:10px;padding:8px 16px;background:#28a745;color:#fff;border:none;border-radius:5px;cursor:pointer;">Yes</button>
        <button id="promptNoBtn" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:5px;cursor:pointer;">No</button>
      </div>
    </div>
  `;

  document.body.appendChild(box);

  // âœ… Attach event listeners after element is added
  document.getElementById("promptYesBtn").onclick = () => {
    box.remove();
    onConfirm(true);
  };
  document.getElementById("promptNoBtn").onclick = () => {
    box.remove();
    onConfirm(false);
  };
}


// âœ… Delete service using promptToast + showToast
async function deleteService(id) {
  promptToast("Are you sure you want to delete this service?", async (confirmed) => {
    if (confirmed) {
      try {
        await servicesRef.doc(id).delete();
        showToast("Service deleted successfully.", "success");
        loadServices();
      } catch (err) {
        showToast("Error deleting: " + err.message, "error");
      }
    } else {
      showToast("Deletion cancelled.", "error");
    }
  });
}


// âœ… Edit service and rebind default submit
function editService(data, id) {
  document.getElementById("svcName").value = data.name;
  document.getElementById("svcCounty").value = data.county;
  document.getElementById("svcSubCounty").value = data.subcounty;
  document.getElementById("svcOccupation").value = data.occupation;
  document.getElementById("svcExperience").value = data.experience;
  document.getElementById("svcPhone").value = data.phone;

  const btn = document.querySelector("#serviceForm button");
  btn.innerHTML = "Update Service";

  // Replace the form element to remove previous listeners
  const oldForm = document.getElementById("serviceForm");
  const newForm = oldForm.cloneNode(true);
  oldForm.parentNode.replaceChild(newForm, oldForm);

  // Add update submit handler
  newForm.addEventListener("submit", async function (e) {
    e.preventDefault();
    try {
      const updated = {
        name: document.getElementById("svcName").value,
        county: document.getElementById("svcCounty").value,
        subcounty: document.getElementById("svcSubCounty").value,
        occupation: document.getElementById("svcOccupation").value,
        experience: document.getElementById("svcExperience").value,
        phone: document.getElementById("svcPhone").value,
        postedBy: data.postedBy,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };
      await servicesRef.doc(id).update(updated);
      showCustomAlert("âœ… Service updated.");
      newForm.reset();
      loadServices();

      btn.innerHTML = `<i class="fas fa-concierge-bell" style="margin-right:6px;"></i> Submit Service`;
      attachServiceFormSubmit(); // ðŸ‘ˆ Reattach default
    } catch (err) {
      showCustomAlert("Error updating: " + err.message, "error");
    }
  });
}

// âœ… Filter services
function filterServices() {
  const county = document.getElementById("filterServiceCounty").value;
  const occupation = document.getElementById("filterOccupation").value.toLowerCase();

  document.querySelectorAll(".service-card").forEach(card => {
    const matchesCounty = !county || card.dataset.county === county;
    const matchesOccupation = !occupation || card.dataset.occupation.includes(occupation);

    card.style.display = matchesCounty && matchesOccupation ? "" : "none";
  });
}


// âœ… Global Submit Handler for Market Form
async function submitMarketHandler(e) {
  e.preventDefault();

  if (!isLoggedIn || !currentUser) {
    showPage("login");
    return alert("You must be logged in.");
  }

  const itemName = document.getElementById("itemName").value.trim();
  const itemCategory = document.getElementById("itemCategory").value;
  const itemDescription = document.getElementById("itemDescription").value.trim();
  const itemPrice = document.getElementById("itemPrice").value.trim();
  const itemCounty = document.getElementById("itemCounty").value;
  const itemSubcounty = document.getElementById("itemSubcounty").value.trim();
  const itemPhone = document.getElementById("itemPhone").value.trim();
  const itemPhotoFile = document.getElementById("itemPhoto").files[0];

  // âœ… Add this if you add a dropdown for condition
  const itemConditionInput = document.getElementById("itemCondition");
  const itemCondition = itemConditionInput ? itemConditionInput.value : "New";

  const posterName = currentUser.displayName || currentUser.email || "Anonymous";

  const itemData = {
    name: itemName,
    category: itemCategory,
    description: itemDescription, // this will appear as "Status"
    price: itemPrice,
    county: itemCounty,
    subcounty: itemSubcounty,
    phone: itemPhone,
    postedBy: currentUser.uid,
    posterName: posterName,  // Storing the poster's name (updated)
    condition: itemCondition,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  };

  try {
    if (itemPhotoFile) {
      const photoPath = `marketPhotos/${Date.now()}_${itemPhotoFile.name}`;
      const photoSnap = await storage.ref(photoPath).put(itemPhotoFile);
      itemData.photoURL = await photoSnap.ref.getDownloadURL();
    }

    await marketRef.add(itemData);
    showCustomAlert("âœ… Item posted!", "success");
    document.getElementById("marketForm").reset();
    loadMarketItems();

    // âœ… Notify Admin
    await db.collection("adminNotifications").add({
      type: "Marketplace Post",
      message: `New item posted: ${itemName} (${itemCategory}), Price: ${itemPrice}, Phone: ${itemPhone}, County: ${itemCounty}`,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      read: false
    });

  } catch (err) {
    showCustomAlert("âŒ Error: " + err.message, "error");
  }
}
  function filterMarketItems() {
    loadMarketItems();
  }

  function resetMarketFilters() {
    document.getElementById("filterItemCategory").value = "";
    document.getElementById("filterItemCounty").value   = "";
    document.getElementById("filterMinPrice").value     = "";
    document.getElementById("filterMaxPrice").value     = "";
    loadMarketItems();
  }

 async function loadMarketItems() {
  const container = document.getElementById("marketContainer");
  container.innerHTML = "";

  const minPrice = parseInt(document.getElementById("filterMinPrice").value) || 0;
  const maxPrice = parseInt(document.getElementById("filterMaxPrice").value) || Infinity;
  const categoryFilter = document.getElementById("filterItemCategory").value.toLowerCase().trim();
  const countyFilter = document.getElementById("filterItemCounty").value.toLowerCase().trim();

  try {
    const snapshot = await marketRef.get();
    if (snapshot.empty) {
      container.innerHTML = "<p>No items posted yet.</p>";
      return;
    }

    const boostedItems = [], normalItems = [], now = new Date();

    snapshot.forEach(doc => {
      const d = doc.data();
      const id = doc.id;
      const price = parseFloat(d.price) || 0;

      // Apply filters
      if (price < minPrice || price > maxPrice) return;
      if (categoryFilter && (!d.category || !d.category.toLowerCase().includes(categoryFilter))) return;
      if (countyFilter && (!d.county || !d.county.toLowerCase().includes(countyFilter))) return;

      const isBoosted = d.boosted && d.boostExpiry?.toDate?.() > now;
      (isBoosted ? boostedItems : normalItems).push({ ...d, id });
    });

    if (boostedItems.length + normalItems.length === 0) {
      container.innerHTML = "<p>No items match your filters.</p>";
      return;
    }

    [...boostedItems, ...normalItems].forEach(d => {
      const id = d.id;
      const isPoster = currentUser && currentUser.uid === d.postedBy;
      const isVerified = !!d.postedBy;
      const isBoosted = d.boosted && d.boostExpiry?.toDate?.() > new Date();

      const card = document.createElement("div");
      card.className = "market-card";
      card.id = `market-${id}`;
      card.dataset.category = d.category || "";
      card.dataset.county = d.county || "";
      if (isBoosted) card.dataset.boosted = "true";
      card.style.position = "relative";

      const verifiedBadge = isVerified
        ? `<span class="verified-badge"><i class="fas fa-check-circle"></i> Verified</span>`
        : "";
      const boostBadge = isBoosted
        ? `<span style="color:#ff5722; font-weight:bold; font-size:0.85em; margin-left:6px;">ðŸ”¥ Boosted</span>`
        : "";

      card.innerHTML = `
        ${verifiedBadge}
        <h3 style="margin-bottom:6px; color:#2e7d32;">
          ${d.posterName || "Seller"} ${boostBadge}
        </h3>
        ${d.photoURL
          ? `<img src="${d.photoURL}" style="width:100%;height:180px;object-fit:cover;border-radius:8px;margin-bottom:8px;">`
          : ""}
        <p style="color:#4caf50;">ðŸ“¦ <strong>Item:</strong> ${d.name || "-"}</p>
        <p style="color:#e91e63;">ðŸ·ï¸ <strong>Category:</strong> ${d.category || "-"}</p>
        <p style="color:#ff9800;">ðŸ’° <strong>Price:</strong> KES ${d.price ? parseInt(d.price).toLocaleString() : "N/A"}</p>
        <p style="color:#3f51b5;">ðŸ“ <strong>Location:</strong> ${d.county || "-"}</p>
        <div style="margin-top:8px;">
          <a href="tel:${d.phone}" style="color:green;">ðŸ“ž Call</a> |
          <a href="https://wa.me/254${d.phone?.replace(/^0/, '')}" target="_blank" style="color:#25D366;">ðŸ’¬ WhatsApp</a>
        </div>
        ${isPoster
          ? `<div style="margin-top:10px;">
              <button onclick="deleteMarketItem('${id}')" style="background:#dc3545;color:#fff;border:none;border-radius:5px;padding:6px 12px;cursor:pointer;">ðŸ—‘ï¸ Delete</button>
              <button onclick="showPaymentModalFor('market', 300, '${id}', '${d.name || "Item"}')" style="background:#ff9800;color:#fff;border:none;border-radius:5px;padding:6px 12px;margin-left:8px;cursor:pointer;">ðŸš€ Boost</button>
             </div>`
          : `<div style="margin-top:10px;">
              <button onclick="openChatModal('${d.phone}','${d.posterName || "Seller"}')" style="background:#673ab7;color:#fff;border:none;border-radius:5px;padding:6px 12px;cursor:pointer;">
                <i class="fas fa-comments"></i> Chat
              </button>
            </div>`
        }
      `;

      container.appendChild(card);
      updateAverageRating(id);
    });

  } catch (err) {
    console.error("âŒ Error loading market items:", err);
    showCustomAlert("âŒ Failed to load items: " + err.message, "error");
  }
}


  // Initialize
  document.addEventListener("DOMContentLoaded", () => {
    loadMarketItems();
  });

function boostMarketItem(itemId, itemName) {
  showPhonePrompt(`ðŸš€ Boost "${itemName}" for Ksh 100`, function (phone) {
    // Replace native confirm with a custom modal
    showBoostConfirmModal(itemName, phone, async () => {
      try {
        const response = await fetch("http://localhost:3000/stkpush", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            phone,
            amount: 100,
            accountReference: `BOOST_${itemId}`,
            itemId,
            itemName,
            userId: currentUser?.uid || "anonymous"
          })
        });

        const result = await response.json();

        if (!result.success || result.ResponseCode !== "0") {
          showCustomAlert("âŒ MPESA STK Push failed. Try again.", "error");
          return;
        }

        showCustomAlert("âœ… MPESA prompt sent. Check your phone!", "success");
      } catch (err) {
        console.error("Boost error:", err);
        showCustomAlert("âŒ Boost error: " + err.message, "error");
      }
    });
  });
}

function showPhonePrompt(title = "Enter MPESA Number", callback) {
  const modal = document.createElement("div");
  modal.innerHTML = `
    <div class="modal">
      <div class="modal-content">
        <h3>${title}</h3>
        <input type="text" id="mpesaPhone" placeholder="0712345678 or +2547..." style="width: 90%; padding: 8px; margin-top: 10px;" />
        <div style="margin-top: 15px;">
          <button id="confirmPhone" style="background:#4caf50; color:white; margin-right: 10px;">Confirm</button>
          <button id="cancelPhone" style="background:#f44336; color:white;">Cancel</button>
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  // Style
  const style = document.createElement("style");
  style.textContent = `
    .modal {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5); display: flex;
      justify-content: center; align-items: center; z-index: 1000;
    }
    .modal-content {
      background: #fff; padding: 20px; border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3); text-align: center;
    }
    .modal-content input {
      border: 1px solid #ccc; border-radius: 5px;
    }
    .modal-content button {
      padding: 10px 15px; border: none;
      border-radius: 5px; cursor: pointer;
    }
    .modal-content button:hover {
      opacity: 0.9;
    }
  `;
  document.head.appendChild(style);

  // Confirm button with flexible validation
  document.getElementById("confirmPhone").onclick = () => {
    let phone = document.getElementById("mpesaPhone").value.trim();

    // Normalize phone number to 2547XXXXXXXX
    if (/^07\d{8}$/.test(phone)) {
      phone = "254" + phone.slice(1);
    } else if (/^\+2547\d{8}$/.test(phone)) {
      phone = phone.replace("+", "");
    }

    if (!/^2547\d{8}$/.test(phone)) {
      showCustomAlert("âŒ Invalid phone number. Use formats like 0712345678 or +254712345678", "error");
      return;
    }

    document.body.removeChild(modal);
    callback(phone); // Pass normalized valid phone
  };

  // Cancel button
  document.getElementById("cancelPhone").onclick = () => {
    document.body.removeChild(modal);
    showCustomAlert("âŒ Boost cancelled.", "error");
  };
}

function showBoostConfirmModal(itemName, phone, onConfirm) {
  const modal = document.createElement("div");
  modal.className = "modal";
  modal.innerHTML = `
    <div class="modal-content">
      <h3>ðŸ“¢ Confirm Boost</h3>
      <p>You're about to <strong>boost "${itemName}"</strong> for <strong>Ksh 100</strong>.</p>
      <p>We will send a <strong>MPESA STK prompt</strong> to:</p>
      <p style="font-weight:bold; font-size: 18px;">ðŸ“± ${phone}</p>
      <div style="margin-top: 20px;">
        <button id="confirmBoost" style="background:#4caf50; color:white; margin-right: 10px;">âœ… Confirm Boost</button>
        <button id="cancelBoost" style="background:#f44336; color:white;">Cancel</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);

  // Confirm
  document.getElementById("confirmBoost").onclick = () => {
    document.body.removeChild(modal);
    onConfirm(); // Call the function passed from boostMarketItem
  };

  // Cancel
  document.getElementById("cancelBoost").onclick = () => {
    document.body.removeChild(modal);
    showCustomAlert("âŒ Boost cancelled.", "error");
  };
}


function showCustomConfirm(message, onConfirm) {
  // Remove existing confirm box if any
  const existing = document.getElementById("customConfirmBox");
  if (existing) existing.remove();

  // Create confirm box wrapper
  const wrapper = document.createElement("div");
  wrapper.id = "customConfirmBox";
  wrapper.style.position = "fixed";
  wrapper.style.top = "0";
  wrapper.style.left = "0";
  wrapper.style.width = "100vw";
  wrapper.style.height = "100vh";
  wrapper.style.background = "rgba(0,0,0,0.5)";
  wrapper.style.display = "flex";
  wrapper.style.alignItems = "center";
  wrapper.style.justifyContent = "center";
  wrapper.style.zIndex = "9999";

  // Create modal box
  const modal = document.createElement("div");
  modal.style.background = "#fff";
  modal.style.padding = "20px 30px";
  modal.style.borderRadius = "10px";
  modal.style.boxShadow = "0 0 10px rgba(0,0,0,0.3)";
  modal.style.textAlign = "center";

  modal.innerHTML = `
    <p style="margin-bottom:20px;font-size:16px;">${message}</p>
    <button id="confirmYesBtn" style="margin-right:10px;padding:8px 16px;background:#28a745;color:#fff;border:none;border-radius:5px;cursor:pointer;">Yes</button>
    <button id="confirmNoBtn" style="padding:8px 16px;background:#dc3545;color:#fff;border:none;border-radius:5px;cursor:pointer;">No</button>
  `;

  wrapper.appendChild(modal);
  document.body.appendChild(wrapper);

  // Wait until DOM is ready before binding events
  setTimeout(() => {
    document.getElementById("confirmYesBtn").onclick = () => {
      document.body.removeChild(wrapper);
      onConfirm();
    };

    document.getElementById("confirmNoBtn").onclick = () => {
      document.body.removeChild(wrapper);
    };
  }, 0);
}

function deleteMarketItem(id) { 
  showCustomConfirm("Are you sure you want to delete this market item?", () => {
    marketRef.doc(id).delete()
      .then(() => {
        showCustomAlert("ðŸ—‘ï¸ Item deleted successfully.", "success");
        loadMarketItems(); // refresh
      })
      .catch(err => {
        console.error("âŒ Error deleting item:", err);
        showCustomAlert("âŒ Error deleting item: " + err.message, "error");
      });
  });
}

// âœ… Filter Market Items by Category or County
function filterMarketItems() {
  const category = document.getElementById("filterItemCategory").value;
  const county = document.getElementById("filterItemCounty").value;

  document.querySelectorAll(".market-card").forEach(card => {
    const matchesCategory = !category || card.dataset.category === category;
    const matchesCounty = !county || card.dataset.county === county;
    card.style.display = matchesCategory && matchesCounty ? "" : "none";
  });
}

// ======================= FRONTEND =======================

// âœ… Unified Payment Modal for Multiple Services
function showPaymentModalFor(type, amount, itemId, itemName) {
  const modalHTML = `
    <div id="universalPayModal" class="modal" style="display:block; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999;">
      <div class="modal-content" style="margin:10% auto; padding:20px; background:white; width:80%; max-width:400px; border-radius:8px; text-align:center;">
        <h3>Pay to Unlock: ${itemName}</h3>
        <p>Amount: <strong>Ksh ${amount}</strong></p>
        <input type="tel" id="universalPhone" placeholder="Enter your MPESA number (e.g. 0712345678)" style="padding: 10px; width:100%; margin-bottom:10px;" />
        <button onclick="initiateStkPayment('${type}', ${amount}, '${itemId}', '${itemName}')"
                style="background:#4CAF50; color:white; border:none; padding:10px 20px; border-radius:6px;">
          ðŸ“² Pay with MPESA
        </button>
        <button onclick="closeUniversalModal()" style="margin-top:10px; background:#ccc; border:none; padding:8px 16px;">Cancel</button>
        <p id="universalPaymentStatus" style="margin-top:10px; color:#555;"></p>
      </div>
    </div>
  `;
  document.body.insertAdjacentHTML("beforeend", modalHTML);
}

function closeUniversalModal() {
  const modal = document.getElementById("universalPayModal");
  if (modal) modal.remove();
}

// âœ… Unified STK Push Handler
async function initiateStkPayment(type, amount, itemId, itemName) {
  const phone = document.getElementById("universalPhone").value.trim();
  const statusEl = document.getElementById("universalPaymentStatus");

  if (!/^07\d{8}$/.test(phone)) {
    statusEl.innerText = "âš ï¸ Please enter a valid Safaricom number";
    return;
  }

  statusEl.innerText = "â³ Sending STK Push...";

  try {
    const response = await fetch("http://localhost:3000/stkpush", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        phone,
        amount,
        accountReference: type,
        itemId,
        itemName,
        userId: currentUser?.uid || "anonymous"
      })
    });

    const data = await response.json();
    if (data.success) {
      statusEl.innerText = "âœ… STK Push sent. Please complete payment on your phone.";
    } else {
      statusEl.innerText = `âŒ Error: ${data.errorMessage || "Unknown failure"}`;
    }
  } catch (err) {
    statusEl.innerText = "âŒ Network error: " + err.message;
  }
}

// âœ… Legacy compatibility shim for older code
function showPaymentModal() {
  showPaymentModalFor("swap", 500, currentUser?.uid || "unknown", "Unlock VIP Swaps");
}

// âœ… Usage Examples
// showPaymentModalFor("job", 1000, job.id, "Boost Job Listing")
// showPaymentModalFor("soulmate", 250, currentUser.uid, "Soulmate Contacts")
// showPaymentModalFor("market", 300, marketItem.id, "Boost Market Item")
// showPaymentModalFor("swap", 500, currentUser.uid, "Unlock VIP Swaps")
// showPaymentModalFor("service", 150, serviceId, "Get Service Contact")

async function findMatchingSwaps() {
  if (!isLoggedIn || !currentUser) {
    showCustomAlert("You must be logged in to check swaps.", "error");
    return;
  }

  try {
    const swapsSnapshot = await db.collection("teacherSwaps").get();
    const swaps = [];

    // Collect all swaps
    swapsSnapshot.forEach(doc => {
      swaps.push({ id: doc.id, ...doc.data() });
    });

    // Check for matches
    const matches = [];
    swaps.forEach((swap1, index) => {
      swaps.forEach((swap2, idx) => {
        if (
          index !== idx &&
          swap1.subjectCombination === swap2.subjectCombination &&
          swap1.county === swap2.swapCounty &&
          swap1.swapCounty === swap2.county
        ) {
          matches.push(swap1);
        }
      });
    });

    if (matches.length > 0) {
      populateMatchesModal(matches);
    } else {
      showCustomAlert("No matching swaps found.", "info");
    }
  } catch (error) {
    console.error("Error finding matches:", error);
    showCustomAlert("Error finding matches: " + error.message, "error");
  }
}

function populateMatchesModal(matches) {
  const matchesList = document.getElementById("matchesList");
  matchesList.innerHTML = ""; // Clear previous entries

  matches.forEach(match => {
    const matchDiv = document.createElement("div");
    matchDiv.style.margin = "10px 0";
    matchDiv.innerHTML = `
      <p><strong>Name:</strong> ${match.teacherName}</p>
      <p><strong>Phone:</strong> ${match.phone}</p>
      <p><strong>Subjects:</strong> ${match.subjectCombination}</p>
      <p><strong>County:</strong> ${match.county}</p>
      <p><strong>Wants to Swap to:</strong> ${match.swapCounty}</p>
      <hr>
    `;
    matchesList.appendChild(matchDiv);
  });

  document.getElementById("matchesModal").style.display = "flex";
}

function closeMatchesModal() {
  document.getElementById("matchesModal").style.display = "none";
}
async function findTriangularSwaps() {
  if (!isLoggedIn || !currentUser) {
    showCustomAlert("You must be logged in to check triangular swaps.", "error");
    return;
  }

  try {
    const swapsSnapshot = await db.collection("teacherSwaps").get();
    const swaps = [];

    // Collect all swaps
    swapsSnapshot.forEach(doc => {
      swaps.push({ id: doc.id, ...doc.data() });
    });

    // Find triangular swaps
    const triangularSwaps = [];
    swaps.forEach((swapA, indexA) => {
      swaps.forEach((swapB, indexB) => {
        if (
          indexA !== indexB &&
          swapA.swapCounty === swapB.county &&
          swapA.county !== swapB.swapCounty
        ) {
          swaps.forEach((swapC, indexC) => {
            if (
              indexB !== indexC &&
              swapB.swapCounty === swapC.county &&
              swapC.swapCounty === swapA.county
            ) {
              triangularSwaps.push([swapA, swapB, swapC]);
            }
          });
        }
      });
    });

    if (triangularSwaps.length > 0) {
      populateTriangularSwapsModal(triangularSwaps);
    } else {
      showCustomAlert("No triangular swaps found.", "info");
    }
  } catch (error) {
    console.error("Error finding triangular swaps:", error);
    showCustomAlert("Error finding triangular swaps: " + error.message, "error");
  }
}

function populateTriangularSwapsModal(triangularSwaps) {
  const swapsList = document.getElementById("triangularSwapsList");
  swapsList.innerHTML = ""; // Clear previous entries

  triangularSwaps.forEach(([swapA, swapB, swapC]) => {
    const swapDiv = document.createElement("div");
    swapDiv.style.margin = "10px 0";
    swapDiv.innerHTML = `
      <div>
        <p><strong>Teacher A:</strong> ${swapA.teacherName} (${swapA.county} ? ${swapA.swapCounty})</p>
        <p><strong>Teacher B:</strong> ${swapB.teacherName} (${swapB.county} ? ${swapB.swapCounty})</p>
        <p><strong>Teacher C:</strong> ${swapC.teacherName} (${swapC.county} ? ${swapC.swapCounty})</p>
      </div>
      <hr>
    `;
    swapsList.appendChild(swapDiv);
  });

  document.getElementById("triangularSwapsModal").style.display = "flex";
}

// Close modal functionality
document.getElementById("closeTriangularSwapsModal").addEventListener("click", () => {
  document.getElementById("triangularSwapsModal").style.display = "none";
});

function showToast(message, type = "info") {
  const toast = document.createElement("div");
  toast.textContent = message;
  toast.style.padding = "12px 18px";
  toast.style.marginTop = "10px";
  toast.style.borderRadius = "6px";
  toast.style.fontSize = "15px";
  toast.style.color = "white";
  toast.style.boxShadow = "0 4px 8px rgba(0,0,0,0.1)";
  toast.style.opacity = "0.95";
  toast.style.transition = "transform 0.3s ease, opacity 0.3s ease";

  // Color based on type
  switch (type) {
    case "success":
      toast.style.backgroundColor = "#28a745"; // Green
      break;
    case "error":
      toast.style.backgroundColor = "#dc3545"; // Red
      break;
    case "warning":
      toast.style.backgroundColor = "#ffc107"; // Yellow
      toast.style.color = "#000";
      break;
    default:
      toast.style.backgroundColor = "#007bff"; // Blue
  }

  // Add to container
  const container = document.getElementById("toastContainer");
  container.appendChild(toast);

  // Auto remove
  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transform = "translateX(100%)";
    setTimeout(() => container.removeChild(toast), 400);
  }, 3000);
}


function confirmDeleteSwap(callback) {
  const modal = document.getElementById("confirmDeleteModal");
  const progressBar = document.getElementById("confirmProgressBar");
  modal.style.display = "flex";

  let duration = 5; // seconds
  let width = 100;
  let interval;

  function startCountdown() {
    interval = setInterval(() => {
      width -= 100 / (duration * 10);
      progressBar.style.width = width + "%";

      if (width <= 0) {
        clearInterval(interval);
        modal.style.display = "none";
        callback(false);
        showToast(" Deletion timed out.", "warning");
      }
    }, 100);
  }

  // Confirm click
  document.getElementById("confirmYes").onclick = () => {
    clearInterval(interval);
    modal.style.display = "none";
    callback(true);
  };

  // Cancel click
  document.getElementById("confirmNo").onclick = () => {
    clearInterval(interval);
    modal.style.display = "none";
    callback(false);
    showToast(" Deletion cancelled.", "warning");
  };

  // Reset bar and start
  progressBar.style.width = "100%";
  startCountdown();
}

async function deleteSwap(id) {
  confirmDeleteSwap(async (confirmed) => {
    if (!confirmed) {
      showToast("Deletion cancelled.", "warning");
      return;
    }

    try {
      await db.collection("teacherSwaps").doc(id).delete();
      showToast("Swap deleted successfully.", "success");
      loadSwaps(); // Reload updated list
    } catch (error) {
      console.error("Delete failed:", error);
      showToast(" Failed to delete swap: " + error.message, "error");
    }
  });
}


function showCustomAlert(message, type = "info") {
  const alertBox = document.createElement("div");
  alertBox.innerText = message;

  alertBox.style.position = "fixed";
  alertBox.style.top = "50%";
  alertBox.style.left = "50%";
  alertBox.style.transform = "translate(-50%, -50%)";
  alertBox.style.padding = "20px";
  alertBox.style.borderRadius = "8px";
  alertBox.style.color = "white";
  alertBox.style.zIndex = "1000";
  alertBox.style.boxShadow = "0 4px 8px rgba(0, 0, 0, 0.2)";
  alertBox.style.fontSize = "16px";
  alertBox.style.textAlign = "center";

  if (type === "success") {
    alertBox.style.backgroundColor = "#4caf50";
  } else if (type === "error") {
    alertBox.style.backgroundColor = "#f44336";
  } else {
    alertBox.style.backgroundColor = "#007bff";
  }

  document.body.appendChild(alertBox);
  setTimeout(() => {
    alertBox.remove();
  }, 3000);
}


async function loadNotifications() {
  const myName = currentUser.displayName || currentUser.email;
  const ul = document.getElementById("notificationList");
  ul.innerHTML = "<li>Loading...</li>";

  try {
    const snapshot = await db.collection("soulmateInterests")
      .where("toName", "==", myName)
      .orderBy("timestamp", "desc")
      .get();

    if (snapshot.empty) {
      ul.innerHTML = "<li>No notifications yet.</li>";
      return;
    }

    ul.innerHTML = "";
    snapshot.forEach(doc => {
      const d = doc.data();
      ul.innerHTML += `<li>ðŸ’Œ <strong>${d.fromName}</strong> liked you!</li>`;
    });
  } catch (err) {
    ul.innerHTML = `<li>Error loading notifications: ${err.message}</li>`;
  }
}
function filterSwaps() {
  const category = document.getElementById("filterCategory").value.toLowerCase();
  const swapCounty = document.getElementById("filterSwapCounty").value.toLowerCase();
  const swapSubCounty = document.getElementById("filterSwapSubCounty").value.toLowerCase();
  const hardship = document.getElementById("filterHardship")?.value.toLowerCase() || "";
  const subjectInput = document.getElementById("filterSubjectCombination")?.value.toLowerCase() || "";

  const table = document.getElementById("swapTable");
  const rows = table.querySelectorAll("tbody tr");

  let visibleCount = 0;

  rows.forEach(row => {
    const rowCategory = row.children[7]?.textContent.toLowerCase() || "";
    const rowSwapCounty = row.children[5]?.textContent.toLowerCase() || "";
    const rowSwapSubCounty = row.children[6]?.textContent.toLowerCase() || "";
    const rowHardship = row.children[8]?.textContent.toLowerCase() || "";
    const rowSubject = row.children[4]?.textContent.toLowerCase() || "";

    const matchCategory = !category || rowCategory.includes(category);
    const matchCounty = !swapCounty || rowSwapCounty.includes(swapCounty);
    const matchSubCounty = !swapSubCounty || rowSwapSubCounty.includes(swapSubCounty);
    const matchHardship = !hardship || rowHardship.includes(hardship);
    const matchSubject = !subjectInput || rowSubject.includes(subjectInput);

    const shouldShow = matchCategory && matchCounty && matchSubCounty && matchHardship && matchSubject;

    if (shouldShow) {
      row.style.display = "";
      visibleCount++;
    } else {
      row.style.display = "none";
    }
  });

  if (visibleCount === 0) {
    showCustomAlert("â—No matching swaps found.", "error");
  }
}
// ðŸ”¥ VIP Auto-flagging helper
const hotCounties = ["Nairobi", "Kisumu", "Mombasa", "Kisii", "Nakuru"];

async function markAsVIPSwap(swapId) {
  try {
    await db.collection("teacherSwaps").doc(swapId).update({ isVIP: true });
    showCustomAlert("ðŸ”¥ Swap marked as VIP successfully!", "success");
    loadSwaps(); // refresh list
  } catch (err) {
    showCustomAlert("âŒ Failed to mark VIP: " + err.message, "error");
  }
}

async function showHotSwaps() {
  try {
    const snapshot = await db.collection("teacherSwaps").get();
    const vipCandidates = [];

    snapshot.forEach(doc => {
      const s = doc.data();
      if (
        (hotCounties.includes(s.county) || hotCounties.includes(s.swapCounty)) &&
        !s.isVIP
      ) {
        vipCandidates.push({ id: doc.id, ...s });
      }
    });

    renderSwaps(vipCandidates); // This renders hot swap candidates only
  } catch (err) {
    showCustomAlert("âŒ Failed to load hot swaps: " + err.message, "error");
  }
}

async function showVipSwaps() {
  if (!isLoggedIn) {
    return showCustomAlert("Please login to view VIP swaps.", "error");
  }

  await loadUserPaymentStatus(); // make sure payment flags are set

  const container = document.getElementById("vipSwapsList");
  container.innerHTML = "<p>Loading VIP swaps...</p>";
  document.getElementById("vipSwapsModal").style.display = "block";

  try {
    const snapshot = await db.collection("teacherSwaps")
      .orderBy("timestamp", "desc")
      .get();

    if (snapshot.empty) {
      container.innerHTML = "<p>No VIP swaps available at the moment.</p>";
      return;
    }

    let html = `<div style="display:flex; flex-wrap:wrap; gap:10px;">`;
    snapshot.forEach(doc => {
      const s = doc.data();

      // ðŸ”¥ Auto-VIP if from/to counties are in hot list
      const isVip = s.isVIP || hotCounties.includes(s.county) || hotCounties.includes(s.swapCounty);

      if (!isVip) return; // Only show swaps considered VIP

      const name = s.teacherName || "-";
      const school = s.category || "-";
      const subject = s.subjectCombination || "-";
      const from = `${s.county || '-'} (${s.subCounty || '-'})`;
      const to = `${s.swapCounty || '-'} (${s.swapSubCounty || '-'})`;

      let phoneDisplay = "";

      if (isAdmin || hasPaidVip1000) {
        phoneDisplay = `<p><strong>ðŸ“ž Phone:</strong> <a href="tel:${s.phone}" style="color:green;">${s.phone}</a></p>`;
      } else {
        phoneDisplay = `
          <p><strong>ðŸ“ž Phone:</strong> 
            <button onclick="promptVipPayment()" style="background:crimson; color:white; border:none; padding:6px 10px; border-radius:5px;">
              ðŸ’° Pay KES 1000 to Unlock VIP
            </button>
          </p>`;
      }

      html += `
        <div style="border:1px solid #ddd; padding:10px; border-radius:8px; width:260px;">
          <p><strong>ðŸ‘¤ Name:</strong> ${name}</p>
          <p><strong>ðŸ« School Type:</strong> ${school}</p>
          <p><strong>ðŸ“š Subject(s):</strong> ${subject}</p>
          <p><strong>ðŸ” Swap From:</strong> ${from}</p>
          <p><strong>âž¡ï¸ Swap To:</strong> ${to}</p>
          ${phoneDisplay}
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

  } catch (err) {
    container.innerHTML = `<p style="color:red;">Failed to load VIP swaps: ${err.message}</p>`;
  }
}

function promptVipPayment() {
  const confirmPayment = confirm("To unlock all VIP swaps, please pay KES 1000 to Paybill 123456, Account: VIPACCESS. Have you completed payment?");
  if (confirmPayment) {
    // Simulate update (replace with actual admin approval logic)
    db.collection("users").doc(currentUserId).update({
      hasPaidVip1000: true
    }).then(() => {
      hasPaidVip1000 = true;
      showCustomAlert("VIP access unlocked. Please reopen the VIP swaps.", "success");
    }).catch(err => {
      showCustomAlert("Error unlocking VIP access: " + err.message, "error");
    });
  }
}
async function loadUserPaymentStatus() {
  if (!currentUserId) return;

  const userDoc = await db.collection("users").doc(currentUserId).get();
  const data = userDoc.data();

  hasPaid100 = data?.hasPaid100 || false;
  hasPaidVip1000 = data?.hasPaidVip1000 || false;
  isAdmin = data?.role === "admin"; // optional
}


async function loadAdminNotifications() {
  const list = document.getElementById("notificationList");
  list.innerHTML = "";

  const snapshot = await db.collection("adminNotifications")
    .orderBy("timestamp", "desc")
    .get();

  if (snapshot.empty) {
    list.innerHTML = "<p>No admin notifications yet.</p>";
    return;
  }

  const batch = db.batch(); // ðŸ“¦ To mark them all as read

  snapshot.forEach(doc => {
    const d = doc.data();

    // âœ… Mark as read
    if (d.read === false) {
      batch.update(doc.ref, { read: true });
    }

    const li = document.createElement("li");
    li.style.cssText = "margin-bottom:10px;padding:10px;border:1px solid #ccc;border-radius:8px;background:#f9f9f9;cursor:pointer;";
    
    // âœ… Handle click to scroll to item
    li.onclick = () => openPostedItem(d.type?.toLowerCase(), d.itemId);

    li.innerHTML = `
      <b>${d.type}</b>: ${d.message}<br>
      <small style="color:gray;">${new Date(d.timestamp?.toDate()).toLocaleString()}</small><br>
      <button onclick="event.stopPropagation(); deleteNotification('${doc.id}')"
              style="margin-top:6px;">ðŸ—‘ï¸ Delete</button>
    `;

    list.appendChild(li);
  });

  await batch.commit(); // âœ… Apply read updates
  updateAdminNotifBadge(); // ðŸ”„ Refresh badge
}


async function deleteNotification(id) {
  try {
    await db.collection("adminNotifications").doc(id).delete();
    loadAdminNotifications();       // ðŸ” Refresh the list
    updateAdminNotifBadge();        // ðŸ”´ Refresh the badge count
  } catch (err) {
    alert("Error deleting notification: " + err.message);
  }
}

async function updateAdminNotifBadge() {
  const badge = document.getElementById("notifBadge");
  if (!isAdmin || !badge) return;

  try {
    const snapshot = await db.collection("adminNotifications")
      .where("read", "==", false)
      .get();

    const count = snapshot.size;

    if (count > 0) {
      badge.style.display = "inline-block";
      badge.textContent = count;
    } else {
      badge.style.display = "none";
    }
  } catch (err) {
    console.error("Failed to load notification badge:", err);
  }
}
async function viewConversation(userA, userB) {
  const chatId = [userA, userB].sort().join("_");
  const container = document.getElementById("chatMessages");
  container.innerHTML = "";

  const snapshot = await db.collection("messages").doc(chatId).collection("chats").orderBy("timestamp").get();

  snapshot.forEach(doc => {
    const d = doc.data();
    const div = document.createElement("div");
    div.innerHTML = `<strong>${d.from}:</strong> ${d.content}`;
    container.appendChild(div);
  });

  document.getElementById("chatBox").style.display = "block";
  document.getElementById("chatWith").textContent = `${userA} â†” ${userB}`;
}

async function updateChatBadge() {
  const myName = currentUser.displayName || currentUser.email;
  let unreadCount = 0;

  const snapshot = await db.collection("messages").get();
  for (const doc of snapshot.docs) {
    const chats = await doc.ref.collection("chats")
      .where("to", "==", myName)
      .where("read", "==", false)
      .get();

    if (!chats.empty) unreadCount++;
  }

  const badge = document.getElementById("chatNotifBadge");
  if (badge) {
    badge.style.display = unreadCount > 0 ? "inline-block" : "none";
    badge.textContent = unreadCount;
  }
}

async function rateService(serviceId, stars) {
  if (!currentUser) {
    return showCustomAlert("ðŸ” Please login to rate a service.", "error");
  }

  const userId = currentUser.uid;
  const ratingRef = db.collection("ratings").doc(serviceId).collection("byUser").doc(userId);

  try {
    const existing = await ratingRef.get();
    if (existing.exists) {
      return showCustomAlert("â­ You already rated this service.", "info");
    }

    await ratingRef.set({
      stars,
      ratedAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    updateAverageRating(serviceId);
    showCustomAlert(`âœ… Rated ${stars} star${stars > 1 ? "s" : ""}. Thank you!`, "success");

  } catch (err) {
    console.error("Rating error:", err);
    showCustomAlert("âŒ Failed to submit rating. Please try again.", "error");
  }
}
function showCustomAlert(message, type = "info") {
  const alert = document.createElement("div");
  alert.textContent = message;
  alert.style.cssText = `
    position: fixed;
    top: 20%;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    background: ${type === "success" ? "#4CAF50" : type === "error" ? "#f44336" : "#2196F3"};
    color: white;
    font-weight: bold;
    border-radius: 6px;
    z-index: 9999;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    animation: fadeInOut 3s ease-in-out forwards;
  `;

  document.body.appendChild(alert);

  setTimeout(() => alert.remove(), 3000);
}


async function updateAverageRating(serviceId) {
  const ratingSnap = await db.collection("ratings").doc(serviceId).collection("byUser").get();
  const total = ratingSnap.docs.reduce((sum, doc) => sum + doc.data().stars, 0);
  const count = ratingSnap.size;
  const avg = count ? (total / count).toFixed(1) : "No ratings yet";

  document.getElementById(`avgRating-${serviceId}`).innerText = `â­ ${avg} (${count})`;

  // Fill stars based on average
  for (let i = 1; i <= 5; i++) {
    const starEl = document.getElementById(`star-${serviceId}-${i}`);
    if (starEl) starEl.style.color = i <= Math.round(avg) ? "#ffc107" : "#ccc";
  }
}
function sendQuickMessage(text) {
  document.getElementById("chatInput").value = text;
  sendChatMessage();
}
async function deleteMessage(convoId, messageId, btn) {
  const confirmed = confirm("Are you sure you want to delete this message?");
  if (!confirmed) return;

  try {
    await db.collection("messages").doc(convoId).collection("chats").doc(messageId).delete();
    btn.closest(".chat-bubble").remove();
  } catch (error) {
    alert("âŒ Failed to delete message. Please try again.");
    console.error(error);
  }
}
function deleteMessage(convoId, messageId, btn) {
  showCustomConfirm("Are you sure you want to delete this message?", async () => {
    try {
      await db.collection("messages")
        .doc(convoId)
        .collection("chats")
        .doc(messageId)
        .delete();

      btn.closest(".chat-bubble").remove();
      showCustomAlert("ðŸ—‘ Message deleted successfully!", "success");
    } catch (error) {
      console.error("âŒ Delete error:", error);
      showCustomAlert("âŒ Failed to delete message.", "error");
    }
  });
}

function showMyChats() {
  const container = document.getElementById("chatListContainer");
  container.innerHTML = '';
  showPage("chatListPage"); // switch to chat list page

  db.collection("users").doc(currentUser.uid).collection("conversations")
    .orderBy("lastTimestamp", "desc")
    .get()
    .then(snapshot => {
      snapshot.forEach(doc => {
        const convo = doc.data();

        const div = document.createElement("div");
        div.className = "conversation-item";
        div.style.display = "flex";
        div.style.alignItems = "center";
        div.style.padding = "8px";
        div.style.borderBottom = "1px solid #ccc";
        div.style.cursor = "pointer";

        // Build conversation item HTML
        div.innerHTML = `
          <img src="${convo.partnerPhotoUrl}" class="avatar" style="width:40px; height:40px; border-radius:50%; margin-right:8px;">
          <div style="flex:1;">
            <strong>${convo.partnerName}</strong><br>
            <small>${convo.lastMessage}</small>
          </div>
        `;

        // If there's an unread count, add badge
        if (convo.unreadCount && convo.unreadCount > 0) {
          const badge = document.createElement("span");
          badge.textContent = convo.unreadCount;
          badge.style.background = "red";
          badge.style.color = "white";
          badge.style.padding = "2px 6px";
          badge.style.borderRadius = "12px";
          badge.style.marginLeft = "8px";
          badge.style.fontSize = "12px";
          div.appendChild(badge);
        }

        // When clicked â€” start chat with this person
        div.onclick = () => startChat(convo.partnerUid, convo.partnerName, convo.partnerPhotoUrl, "page");

        container.appendChild(div);
      });
    });
}

function loadMyChats() {
  const container = document.getElementById("chatListContainer");
  container.innerHTML = '';

  db.collection("users").doc(currentUser.uid)
    .collection("conversations")
    .orderBy("lastTimestamp", "desc")
    .get()
    .then(snapshot => {
      snapshot.forEach(doc => {
        const convo = doc.data();
        // display convo info + add click handlers to open that chat
      });
    });
}

function updateUnreadMessages() {
  const badge = document.getElementById('notifBadge');
  
  // Fetch unread count from Firestore
  db.collection("users")
    .doc(chatPartner.uid) // Get the chat partner's document
    .collection("conversations")
    .doc(chatConversationId)
    .get()
    .then(doc => {
      const unreadCount = doc.exists ? doc.data().unreadCount : 0;
      if (unreadCount > 0) {
        badge.style.display = 'inline';
        badge.textContent = unreadCount;
      } else {
        badge.style.display = 'none';
      }
    });
}
document.querySelector('#notifBadge').addEventListener('click', function() {
  showPage('messages'); // Open the messages page
  resetUnreadCount(); // Reset unread count to 0
});

function resetUnreadCount() {
  // Reset the unread count in Firestore when the user opens the chat
  db.collection("users")
    .doc(currentUser.uid)
    .collection("conversations")
    .doc(chatConversationId)
    .update({
      unreadCount: 0
    })
    .then(() => {
      updateUnreadMessages(); // Re-check and update the badge
    });
}

function openPostedItem(type, itemId) {
  if (!type || !itemId) return;

  showPage(type); // Switch to the relevant page/tab

  let retries = 10; // retry every 200ms for 2 seconds
  const targetId = `${type}-${itemId}`;

  const tryScroll = () => {
    const target = document.getElementById(targetId);
    if (target) {
      target.scrollIntoView({ behavior: "smooth", block: "center" });
      target.style.transition = "background-color 0.5s ease";
      target.style.backgroundColor = "#fff9c4";
      setTimeout(() => {
        target.style.backgroundColor = "";
      }, 2000);
    } else if (retries > 0) {
      retries--;
      setTimeout(tryScroll, 200);
    } else {
      alert("âŒ Item not found. It may not have loaded yet.");
    }
  };

  tryScroll();
}

function renderNotifications(notifications) {
  const container = document.getElementById("notificationsContainer");
  container.innerHTML = "";

  if (!notifications.length) {
    container.innerHTML = `<p>No notifications yet.</p>`;
    return;
  }

  notifications.forEach(n => {
    const card = document.createElement("div");
    card.className = "notif-card";
    card.innerHTML = `
      <div onclick="openPostedItem('${n.type}', '${n.itemId}')"
        style="cursor:pointer; background:#f1f8e9; padding:10px; margin-bottom:6px; border-radius:6px;">
        ðŸ”” ${n.message}
      </div>
    `;
    container.appendChild(card);
  });
}
function toggleEmojiPicker() {
  const picker = document.getElementById("emojiPicker");
  picker.style.display = picker.style.display === "block" ? "none" : "block";
  if (picker.innerHTML === '') populateEmojiPicker();
}

function populateEmojiPicker() {
  const picker = document.getElementById("emojiPicker");
  const emojis = ['ðŸ˜€','ðŸ˜','ðŸ˜‚','ðŸ˜…','ðŸ˜Š','ðŸ˜','ðŸ˜Ž','ðŸ˜¢','ðŸ˜­','ðŸ˜¡','ðŸ˜‡','ðŸ¤”','ðŸ‘','ðŸ™','ðŸ’¯','ðŸ”¥','ðŸŽ‰','ðŸ“±','ðŸ’¬','ðŸ•’','ðŸ’–'];
  emojis.forEach(e => {
    const span = document.createElement("span");
    span.textContent = e;
    span.style.margin = "5px";
    span.style.fontSize = "20px";
    span.style.cursor = "pointer";
    span.onclick = () => {
      document.getElementById("chatInput").value += e;
      toggleEmojiPicker();
    };
    picker.appendChild(span);
  });
}

document.addEventListener('click', function(e) {
  const picker = document.getElementById("emojiPicker");
  if (picker && !picker.contains(e.target) && e.target.innerText !== 'ðŸ˜€') {
    picker.style.display = "none";
  }
});

let previewFile = null;

function previewImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    document.getElementById('imagePreview').src = e.target.result;
    document.getElementById('imagePreviewContainer').style.display = 'block';
  };
  reader.readAsDataURL(file);
  previewFile = file;
}

function clearPreview() {
  previewFile = null;
  document.getElementById('mediaInput').value = ''; // Clear the file input
  document.getElementById('imagePreviewContainer').style.display = 'none'; // Hide preview
}

let recorder, audioBlob;

async function toggleRecording() {
  const recordBtn = document.getElementById("recordBtn");

  if (!recorder) {
    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    recorder = new MediaRecorder(stream);
    const chunks = [];

    recorder.ondataavailable = e => chunks.push(e.data);
    recorder.onstop = async () => {
      audioBlob = new Blob(chunks, { type: 'audio/webm' });
      const storageRef = firebase.storage().ref(`voice_notes/${Date.now()}.webm`);
      await storageRef.put(audioBlob);
      const audioURL = await storageRef.getDownloadURL();
      await sendVoiceMessage(audioURL);
      recorder = null;
    };

    recorder.start();
    recordBtn.textContent = "â¹ Stop";
  } else {
    recorder.stop();
    recordBtn.textContent = "ðŸŽ¤";
  }
}

async function sendVoiceMessage(url) {
  const fromName = currentUser.displayName || currentUser.email;
  const timestamp = firebase.firestore.FieldValue.serverTimestamp();

  await db.collection("messages").doc(chatConversationId).collection("chats").add({
    from: fromName,
    fromUid: currentUser.uid,
    to: chatPartner.name,
    toUid: chatPartner.uid,
    type: "audio",
    content: url,
    read: false,
    timestamp
  });

  showCustomAlert("ðŸŽ¤ Voice note sent!", "success");
}
function shareLocation() {
  if (!navigator.geolocation) {
    alert("Geolocation is not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(position => {
    const link = `https://www.google.com/maps?q=${position.coords.latitude},${position.coords.longitude}`;
    document.getElementById("chatInput").value = `My location: ${link}`;
    sendChatMessage('text');
  }, () => {
    alert("Failed to get your location");
  });
}
// Shows the alert popup
function showAlert(message) {
  // Check if an alert is already visible
  if (document.querySelector('.scroll-end-alert')) return;

  const alert = document.createElement('div');
  alert.className = 'scroll-end-alert';
  alert.textContent = message;
  document.body.appendChild(alert);

  setTimeout(() => {
    alert.remove();
  }, 3000); // Auto-remove after 3 seconds
}

// Detect scroll end inside a container
function watchScrollEnd(containerId) {
  const container = document.getElementById(containerId);
  if (!container) return;

  container.addEventListener('scroll', () => {
    const isAtBottom = container.scrollTop + container.clientHeight >= container.scrollHeight - 1;
    if (isAtBottom) {
      showAlert("ðŸš© You have reached the end for today.");
    }
  });
}

// Initialize for desired containers
document.addEventListener('DOMContentLoaded', () => {
  watchScrollEnd('jobContainer');
  watchScrollEnd('soulmateContainer');
  // Add more if needed
});
</script>



</body>
</html>
